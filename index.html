<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LeadRipper AI - Intelligent Lead Generation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Bebas+Neue&family=IBM+Plex+Sans:wght@300;400;600&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-void: #050508;
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-elevated: #1a1a24;
      --bg-hover: #22222e;
      --border-subtle: rgba(255,255,255,0.06);
      --border-medium: rgba(255,255,255,0.1);
      --text-primary: #f0f0f5;
      --text-secondary: #8888a0;
      --text-muted: #55556a;
      --accent-primary: #ff3e00;
      --accent-secondary: #ff3e00;
      --accent-tertiary: #10b981;
      --accent-warning: #f59e0b;
      --accent-danger: #ef4444;
      --glow-primary: rgba(255, 62, 0, 0.15);
      --glow-secondary: rgba(255, 62, 0, 0.15);
      --gradient-primary: linear-gradient(135deg, #ff3e00 0%, #ff3e00 100%);
      --gradient-mesh: radial-gradient(at 20% 30%, rgba(255, 62, 0, 0.08) 0%, transparent 50%),
                       radial-gradient(at 80% 70%, rgba(255, 62, 0, 0.08) 0%, transparent 50%);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'IBM Plex Sans', -apple-system, sans-serif;
      background: #0a0a0a;
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.6;
    }

    /* Scanline effect */
    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.1),
        rgba(0, 0, 0, 0.1) 1px,
        transparent 1px,
        transparent 2px
      );
      pointer-events: none;
      z-index: 9999;
      mix-blend-mode: overlay;
    }

    /* Neural Grid Background */
    .neural-grid {
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(#151515 1px, transparent 1px),
        linear-gradient(90deg, #151515 1px, transparent 1px);
      background-size: 30px 30px;
      opacity: 0.6;
      pointer-events: none;
      z-index: 0;
    }

    .neural-grid::after {
      content: '';
      position: absolute;
      inset: 0;
      background: var(--gradient-mesh);
      animation: meshPulse 20s ease-in-out infinite;
    }

    @keyframes meshPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* Floating Particles */
    .particles {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: var(--accent-primary);
      border-radius: 50%;
      opacity: 0.4;
      animation: float 15s infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(100vh) scale(0); opacity: 0; }
      10% { opacity: 0.6; }
      90% { opacity: 0.6; }
      100% { transform: translateY(-100vh) scale(1); opacity: 0; }
    }

    /* Page Sections */
    .page {
      display: none;
      min-height: 100vh;
      position: relative;
      z-index: 10;
    }

    .page.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Utility Classes */
    .mono {
      font-family: 'JetBrains Mono', monospace;
      letter-spacing: -0.02em;
    }

    .display {
      font-family: 'Bebas Neue', sans-serif;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }
    }

    /* Navigation - Neo-Brutalist Cyberpunk */
    .nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      padding: 0;
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: stretch;
      background: linear-gradient(180deg, rgba(5, 5, 8, 0.95) 0%, rgba(5, 5, 8, 0.85) 100%);
      backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 3px solid var(--accent-primary);
      box-shadow: 0 0 40px rgba(255, 62, 0, 0.3), inset 0 -1px 0 rgba(255, 62, 0, 0.5);
      overflow: hidden;
    }

    .nav::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg,
        transparent 0%,
        var(--accent-primary) 20%,
        transparent 40%,
        var(--accent-primary) 60%,
        transparent 80%,
        var(--accent-primary) 100%
      );
      animation: scanline 4s linear infinite;
    }

    @keyframes scanline {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0;
      text-decoration: none;
      padding: 20px 30px;
      background: var(--accent-primary);
      clip-path: polygon(0 0, 100% 0, 92% 100%, 0 100%);
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .logo::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
      transform: translateX(-100%) skewX(-15deg);
      transition: transform 0.6s;
    }

    .logo:hover::before {
      transform: translateX(100%) skewX(-15deg);
    }

    .logo:hover {
      background: #ff5722;
      box-shadow: 0 0 30px rgba(255, 62, 0, 0.6);
    }

    .logo-mark {
      width: 45px;
      height: 45px;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Orbitron', monospace;
      font-weight: 900;
      font-size: 18px;
      color: #fff;
      position: relative;
      clip-path: polygon(15% 0%, 100% 0%, 85% 100%, 0% 100%);
      border: 2px solid rgba(255, 255, 255, 0.3);
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px var(--accent-primary);
      animation: glitchLogo 5s infinite;
    }

    @keyframes glitchLogo {
      0%, 90%, 100% { transform: translate(0, 0); }
      91% { transform: translate(-2px, 2px); }
      92% { transform: translate(2px, -2px); }
      93% { transform: translate(-2px, -2px); }
      94% { transform: translate(2px, 2px); }
      95% { transform: translate(0, 0); }
    }

    .logo-text {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: 24px;
      color: #000;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-left: 15px;
      text-shadow: 2px 2px 0 rgba(255, 255, 255, 0.3);
      position: relative;
    }

    .nav-links {
      display: flex;
      align-items: stretch;
      gap: 0;
      margin-left: 40px;
    }

    .nav-link {
      font-family: 'Rajdhani', sans-serif;
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
      text-decoration: none;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      padding: 28px 25px;
      position: relative;
      display: flex;
      align-items: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: transparent;
      border-right: 1px solid rgba(255, 255, 255, 0.05);
    }

    .nav-link::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--accent-primary);
      transform: scaleX(0);
      transform-origin: right;
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .nav-link::after {
      content: 'â€º';
      position: absolute;
      right: 8px;
      opacity: 0;
      transform: translateX(-10px);
      transition: all 0.3s;
      color: var(--accent-primary);
      font-size: 20px;
      font-weight: 900;
    }

    .nav-link:hover {
      color: var(--accent-primary);
      background: rgba(255, 62, 0, 0.05);
      padding-right: 35px;
      text-shadow: 0 0 10px rgba(255, 62, 0, 0.5);
    }

    .nav-link:hover::before {
      transform: scaleX(1);
      transform-origin: left;
    }

    .nav-link:hover::after {
      opacity: 1;
      transform: translateX(0);
    }

    .nav-actions {
      display: flex;
      align-items: stretch;
      gap: 0;
      padding-right: 30px;
    }

    .nav-actions .btn {
      margin: 10px 0;
      margin-left: 12px;
      clip-path: polygon(8% 0%, 100% 0%, 92% 100%, 0% 100%);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .nav-actions .btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%);
      transform: translateX(-100%) skewX(-15deg);
      transition: transform 0.5s;
    }

    .nav-actions .btn:hover::before {
      transform: translateX(100%) skewX(-15deg);
    }

    .nav-actions .btn-ghost {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .nav-actions .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--accent-primary);
      box-shadow: 0 0 20px rgba(255, 62, 0, 0.3);
    }

    .nav-actions .btn-primary {
      background: var(--accent-primary);
      border-color: #ff5722;
      box-shadow: 0 4px 15px rgba(255, 62, 0, 0.4);
    }

    .nav-actions .btn-primary:hover {
      background: #ff5722;
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(255, 62, 0, 0.6);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
    }

    .btn-ghost:hover {
      color: var(--text-primary);
      background: var(--bg-hover);
    }

    .btn-outline {
      background: transparent;
      color: var(--text-primary);
      border: 1px solid var(--border-medium);
    }

    .btn-outline:hover {
      background: var(--bg-hover);
      border-color: var(--accent-primary);
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: var(--bg-void);
      font-weight: 700;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px var(--glow-primary);
    }

    .btn-secondary {
      background: var(--bg-elevated);
      color: var(--text-primary);
      border: 1px solid var(--border-medium);
    }

    .btn-secondary:hover {
      background: var(--bg-hover);
    }

    .btn-lg {
      padding: 16px 32px;
      font-size: 16px;
      border-radius: 10px;
    }

    .btn-sm {
      padding: 8px 16px;
      font-size: 13px;
    }

    .btn-mini {
      padding: 6px 12px;
      font-size: 11px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .btn-mini.btn-primary {
      background: var(--gradient-primary);
      color: var(--bg-void);
    }

    .btn-mini.btn-outline {
      background: transparent;
      color: var(--accent-primary);
      border: 1px solid var(--accent-primary);
    }

    .btn-mini.btn-outline:hover {
      background: var(--accent-primary);
      color: var(--bg-void);
    }

    .btn-mini:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-icon {
      width: 40px;
      height: 40px;
      padding: 0;
      border-radius: 8px;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    .btn.loading {
      position: relative;
      color: transparent !important;
    }

    .btn.loading::after {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      border: 2px solid currentColor;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    .btn-primary.loading::after {
      border-color: var(--bg-void);
      border-top-color: transparent;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ===== LANDING PAGE ===== */
    .hero {
      padding: 160px 40px 100px;
      max-width: 1400px;
      margin: 0 auto;
      text-align: center;
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--bg-surface);
      border: 1px solid var(--border-medium);
      border-radius: 100px;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 32px;
    }

    .hero-badge-dot {
      width: 6px;
      height: 6px;
      background: var(--accent-tertiary);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    .hero h1 {
      font-family: 'Syne', sans-serif;
      font-size: clamp(48px, 8vw, 80px);
      font-weight: 800;
      line-height: 1.05;
      margin-bottom: 24px;
      letter-spacing: -2px;
    }

    .hero h1 .gradient {
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-subtitle {
      font-size: 20px;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto 48px;
      line-height: 1.7;
    }

    .hero-cta {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .hero-stats {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 60px;
      margin-top: 80px;
      padding-top: 60px;
      border-top: 1px solid var(--border-subtle);
    }

    .hero-stat {
      text-align: center;
    }

    .hero-stat-value {
      font-family: 'Space Mono', monospace;
      font-size: 36px;
      font-weight: 700;
      color: var(--accent-primary);
    }

    .hero-stat-label {
      font-size: 14px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Features Section */
    .features {
      padding: 100px 40px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .section-header {
      text-align: center;
      margin-bottom: 60px;
    }

    .section-label {
      font-family: 'Space Mono', monospace;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: var(--accent-primary);
      margin-bottom: 16px;
    }

    .section-title {
      font-family: 'Syne', sans-serif;
      font-size: 42px;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .section-subtitle {
      font-size: 18px;
      color: var(--text-secondary);
      max-width: 500px;
      margin: 0 auto;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
    }

    .feature-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 32px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .feature-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--gradient-primary);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .feature-card:hover {
      border-color: var(--border-medium);
      transform: translateY(-4px);
    }

    .feature-card:hover::before {
      opacity: 1;
    }

    .feature-icon {
      width: 48px;
      height: 48px;
      background: var(--bg-elevated);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 20px;
    }

    .feature-card h3 {
      font-family: 'Syne', sans-serif;
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .feature-card p {
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.7;
    }

    /* Pricing Section */
    .pricing {
      padding: 100px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .pricing-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 48px;
    }

    .pricing-toggle-label {
      font-size: 15px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: color 0.2s;
    }

    .pricing-toggle-label.active {
      color: var(--text-primary);
      font-weight: 600;
    }

    .pricing-toggle-switch {
      width: 56px;
      height: 28px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 100px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s;
    }

    .pricing-toggle-switch::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      background: var(--gradient-primary);
      border-radius: 50%;
      top: 2px;
      left: 3px;
      transition: transform 0.3s;
    }

    .pricing-toggle-switch.annual::after {
      transform: translateX(27px);
    }

    .pricing-toggle-switch.annual {
      border-color: var(--accent-primary);
    }

    .pricing-save-badge {
      background: var(--accent-tertiary);
      color: var(--bg-void);
      font-size: 11px;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 100px;
    }

    .trial-badge {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      font-size: 12px;
      font-weight: 700;
      padding: 8px 16px;
      border-radius: 100px;
      display: inline-block;
      margin-bottom: 24px;
    }

    .pricing-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      align-items: start;
      margin-bottom: 80px;
    }

    .pricing-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 20px;
      padding: 40px;
      position: relative;
    }

    .pricing-card.featured {
      background: var(--bg-elevated);
      border-color: var(--accent-primary);
      transform: scale(1.05);
    }

    .pricing-card.featured::before {
      content: 'Most Popular';
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--gradient-primary);
      color: var(--bg-void);
      font-size: 12px;
      font-weight: 700;
      padding: 6px 16px;
      border-radius: 100px;
    }

    .pricing-name {
      font-family: 'Syne', sans-serif;
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .pricing-desc {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }

    .pricing-price {
      display: flex;
      align-items: baseline;
      gap: 4px;
      margin-bottom: 8px;
    }

    .pricing-original {
      font-size: 18px;
      color: var(--text-muted);
      text-decoration: line-through;
      margin-bottom: 8px;
    }

    .pricing-currency {
      font-size: 24px;
      color: var(--text-secondary);
    }

    .pricing-amount {
      font-family: 'Space Mono', monospace;
      font-size: 56px;
      font-weight: 700;
      line-height: 1;
    }

    .pricing-period {
      font-size: 16px;
      color: var(--text-muted);
    }

    .pricing-billed {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 24px;
    }

    .pricing-features {
      list-style: none;
      margin-bottom: 32px;
    }

    .pricing-features li {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      font-size: 15px;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border-subtle);
    }

    .pricing-features li:last-child {
      border-bottom: none;
    }

    .pricing-features .check {
      color: var(--accent-tertiary);
      font-size: 18px;
    }

    /* Lifetime Deals Section */
    .lifetime-section {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 24px;
      padding: 48px;
      text-align: center;
    }

    .lifetime-badge {
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      color: white;
      font-size: 12px;
      font-weight: 700;
      padding: 6px 16px;
      border-radius: 100px;
      display: inline-block;
      margin-bottom: 16px;
    }

    .lifetime-title {
      font-family: 'Syne', sans-serif;
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .lifetime-subtitle {
      font-size: 16px;
      color: var(--text-secondary);
      margin-bottom: 32px;
    }

    .lifetime-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      max-width: 800px;
      margin: 0 auto;
    }

    .lifetime-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 32px;
      text-align: left;
    }

    .lifetime-card.pro {
      border-color: var(--accent-primary);
      background: var(--bg-elevated);
    }

    .lifetime-card-name {
      font-family: 'Syne', sans-serif;
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .lifetime-card-spots {
      font-size: 13px;
      color: var(--accent-tertiary);
      margin-bottom: 16px;
    }

    .lifetime-card-spots.urgent {
      color: #ef4444;
    }

    .lifetime-card-price {
      display: flex;
      align-items: baseline;
      gap: 4px;
      margin-bottom: 8px;
    }

    .lifetime-card-price .currency {
      font-size: 20px;
      color: var(--text-secondary);
    }

    .lifetime-card-price .amount {
      font-family: 'Space Mono', monospace;
      font-size: 42px;
      font-weight: 700;
    }

    .lifetime-card-onetime {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 20px;
    }

    .lifetime-features {
      list-style: none;
      margin-bottom: 24px;
    }

    .lifetime-features li {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 0;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .lifetime-features .check {
      color: var(--accent-tertiary);
    }

    .spots-counter {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 16px;
      padding: 12px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
    }

    .spots-bar {
      flex: 1;
      height: 6px;
      background: var(--bg-elevated);
      border-radius: 100px;
      overflow: hidden;
    }

    .spots-bar-fill {
      height: 100%;
      background: var(--gradient-primary);
      border-radius: 100px;
      transition: width 0.3s;
    }

    .spots-text {
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    /* ===== AUTH PAGES ===== */
    .auth-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }

    .auth-card {
      width: 100%;
      max-width: 440px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 20px;
      padding: 48px;
    }

    .auth-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .auth-header h2 {
      font-family: 'Syne', sans-serif;
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .auth-header p {
      color: var(--text-secondary);
      font-size: 15px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-medium);
      border-radius: 10px;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      color: var(--text-primary);
      transition: all 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--glow-primary);
    }

    .form-input::placeholder {
      color: var(--text-muted);
    }

    .form-hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .form-error {
      font-size: 13px;
      color: var(--accent-danger);
      margin-top: 6px;
    }

    .auth-divider {
      display: flex;
      align-items: center;
      gap: 16px;
      margin: 32px 0;
    }

    .auth-divider::before,
    .auth-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border-subtle);
    }

    .auth-divider span {
      font-size: 13px;
      color: var(--text-muted);
    }

    .auth-footer {
      text-align: center;
      margin-top: 32px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .auth-footer a {
      color: var(--accent-primary);
      text-decoration: none;
      font-weight: 600;
    }

    .auth-footer a:hover {
      text-decoration: underline;
    }

    /* ===== DASHBOARD ===== */
    .dashboard {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 260px;
      background: var(--bg-surface);
      border-right: 1px solid var(--border-subtle);
      padding: 24px;
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      z-index: 50;
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 40px;
      text-decoration: none;
    }

    .sidebar-nav {
      flex: 1;
    }

    .sidebar-section {
      margin-bottom: 32px;
    }

    .sidebar-section-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--text-muted);
      margin-bottom: 12px;
      padding-left: 12px;
    }

    .sidebar-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s;
      cursor: pointer;
      margin-bottom: 4px;
    }

    .sidebar-link:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .sidebar-link.active {
      background: var(--bg-elevated);
      color: var(--accent-primary);
    }

    .sidebar-link-icon {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }

    .sidebar-user {
      padding: 16px;
      background: var(--bg-elevated);
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sidebar-user-avatar {
      width: 40px;
      height: 40px;
      background: var(--gradient-primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      color: var(--bg-void);
    }

    .sidebar-user-info {
      flex: 1;
      min-width: 0;
    }

    .sidebar-user-name {
      font-weight: 600;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .sidebar-user-plan {
      font-size: 12px;
      color: var(--text-muted);
    }

    .main-content {
      flex: 1;
      margin-left: 260px;
      padding: 32px 40px;
      padding-top: 100px;
    }

    .dashboard-view {
      display: none;
    }

    .dashboard-view.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    .page-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 32px;
      padding-top: 16px;
      gap: 16px;
      flex-wrap: wrap;
    }

    .page-title {
      font-family: 'Syne', sans-serif;
      font-size: 28px;
      font-weight: 700;
    }

    .page-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    /* Stats Cards */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 24px;
    }

    .stat-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .stat-card-icon {
      width: 40px;
      height: 40px;
      background: var(--bg-elevated);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .stat-card-trend {
      font-size: 12px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 100px;
    }

    .stat-card-trend.up {
      background: rgba(16, 185, 129, 0.1);
      color: var(--accent-tertiary);
    }

    .stat-card-trend.down {
      background: rgba(239, 68, 68, 0.1);
      color: var(--accent-danger);
    }

    .stat-card-value {
      font-family: 'Space Mono', monospace;
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-card-label {
      font-size: 14px;
      color: var(--text-secondary);
    }

    /* Cards & Panels */
    .panel {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      overflow: hidden;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .panel-title {
      font-family: 'Syne', sans-serif;
      font-size: 18px;
      font-weight: 600;
    }

    .panel-body {
      padding: 24px;
    }

    /* Scraping Controls */
    .scrape-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    .select-wrapper {
      position: relative;
    }

    .form-select {
      width: 100%;
      padding: 14px 44px 14px 16px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-medium);
      border-radius: 10px;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      color: var(--text-primary);
      appearance: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .form-select:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--glow-primary);
    }

    .select-wrapper::after {
      content: '\25BC';
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 10px;
      color: var(--text-muted);
      pointer-events: none;
    }

    /* Tags Input */
    .tags-input-wrapper {
      background: var(--bg-elevated);
      border: 1px solid var(--border-medium);
      border-radius: 10px;
      padding: 8px 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      min-height: 50px;
      align-items: center;
      transition: all 0.2s;
    }

    .tags-input-wrapper:focus-within {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--glow-primary);
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: var(--bg-surface);
      border: 1px solid var(--border-medium);
      border-radius: 6px;
      font-size: 13px;
    }

    .tag.scraped {
      background: rgba(16, 185, 129, 0.1);
      border-color: var(--accent-tertiary);
      color: var(--accent-tertiary);
    }

    .tag-remove {
      cursor: pointer;
      opacity: 0.6;
      transition: opacity 0.2s;
    }

    .tag-remove:hover {
      opacity: 1;
    }

    .tags-input {
      flex: 1;
      min-width: 120px;
      background: transparent;
      border: none;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      color: var(--text-primary);
      outline: none;
    }

    .tags-input::placeholder {
      color: var(--text-muted);
    }

    /* Progress */
    .progress-container {
      margin-top: 24px;
      display: none;
    }

    .progress-container.active {
      display: block;
    }

    .progress-bar-wrapper {
      height: 8px;
      background: var(--bg-elevated);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .progress-bar {
      height: 100%;
      background: var(--gradient-primary);
      width: 0%;
      transition: width 0.3s;
      border-radius: 4px;
    }

    .progress-text {
      font-family: 'Space Mono', monospace;
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* Table */
    .table-wrapper {
      overflow-x: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th {
      text-align: left;
      padding: 14px 20px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-subtle);
    }

    .data-table td {
      padding: 16px 20px;
      font-size: 14px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .data-table tr:last-child td {
      border-bottom: none;
    }

    .data-table tr:hover td {
      background: rgba(255, 62, 0, 0.02);
    }

    /* Badge */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 100px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--accent-tertiary);
    }

    .badge-warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--accent-warning);
    }

    .badge-danger {
      background: rgba(239, 68, 68, 0.1);
      color: var(--accent-danger);
    }

    .badge-info {
      background: rgba(255, 62, 0, 0.1);
      color: var(--accent-primary);
    }

    .badge-neutral {
      background: rgba(136, 136, 160, 0.1);
      color: var(--text-secondary);
    }

    /* Settings */
    .settings-section {
      margin-bottom: 40px;
    }

    .settings-section-title {
      font-family: 'Syne', sans-serif;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .settings-row {
      display: flex;
      align-items: flex-start;
      gap: 40px;
      margin-bottom: 24px;
    }

    .settings-label-col {
      width: 280px;
      flex-shrink: 0;
    }

    .settings-label {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .settings-hint {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .settings-input-col {
      flex: 1;
    }

    /* API Key Input */
    .api-key-input {
      display: flex;
      gap: 12px;
    }

    .api-key-input .form-input {
      flex: 1;
      font-family: 'Space Mono', monospace;
      font-size: 14px;
    }

    /* Toggle */
    .toggle {
      position: relative;
      width: 48px;
      height: 26px;
    }

    .toggle input {
      display: none;
    }

    .toggle-slider {
      position: absolute;
      inset: 0;
      background: var(--bg-elevated);
      border: 1px solid var(--border-medium);
      border-radius: 100px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .toggle-slider::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: var(--text-secondary);
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all 0.2s;
    }

    .toggle input:checked + .toggle-slider {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
    }

    .toggle input:checked + .toggle-slider::before {
      background: var(--bg-void);
      transform: translateX(22px);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 40px;
    }

    .empty-state-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 24px;
      background: var(--bg-elevated);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
    }

    .empty-state-title {
      font-family: 'Syne', sans-serif;
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .empty-state-text {
      color: var(--text-secondary);
      font-size: 15px;
      max-width: 400px;
      margin: 0 auto;
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      inset: 0;
      z-index: 500;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-content {
      background: var(--bg-surface);
      border-radius: 16px;
      border: 1px solid var(--border-medium);
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .modal-header h3 {
      font-family: 'Syne', sans-serif;
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border: none;
      background: var(--bg-hover);
      border-radius: 8px;
      cursor: pointer;
      font-size: 20px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover {
      background: var(--bg-elevated);
      color: var(--text-primary);
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border-subtle);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .toast {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background: var(--bg-surface);
      border: 1px solid var(--border-medium);
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .toast-icon {
      font-size: 20px;
    }

    .toast-success .toast-icon { color: var(--accent-tertiary); }
    .toast-error .toast-icon { color: var(--accent-danger); }
    .toast-info .toast-icon { color: var(--accent-primary); }

    .toast-message {
      font-size: 14px;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .stats-row {
        grid-template-columns: repeat(2, 1fr);
      }
      .features-grid,
      .pricing-grid {
        grid-template-columns: 1fr;
        max-width: 500px;
        margin: 0 auto;
      }
      .pricing-card.featured {
        transform: none;
      }
      .lifetime-grid {
        grid-template-columns: 1fr;
        max-width: 400px;
      }
      .lifetime-section {
        padding: 32px 24px;
      }
      .lifetime-title {
        font-size: 26px;
      }
    }

    @media (max-width: 900px) {
      .nav {
        grid-template-columns: auto auto;
        padding: 0;
      }
      .logo {
        padding: 16px 20px;
      }
      .logo-text {
        font-size: 18px;
        letter-spacing: 1px;
      }
      .logo-mark {
        width: 35px;
        height: 35px;
        font-size: 14px;
      }
      .nav-links {
        display: none;
      }
      .nav-actions {
        padding-right: 20px;
      }
      .nav-actions .btn {
        padding: 8px 16px;
        font-size: 12px;
        margin: 8px 0;
      }
      .hero {
        padding: 120px 24px 60px;
      }
      .hero-stats {
        flex-direction: column;
        gap: 32px;
      }
      .sidebar {
        transform: translateX(-100%);
      }
      .sidebar.open {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0;
        padding: 24px;
        padding-top: 100px;
      }
      .page-header {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
      }
      .page-header > div:last-child {
        flex-wrap: wrap;
      }
      .scrape-controls {
        grid-template-columns: 1fr;
      }
      .settings-row {
        flex-direction: column;
        gap: 12px;
      }
      .settings-label-col {
        width: 100%;
      }
    }
  </style>
  <!-- Airwallex SDK -->
  <script src="https://checkout.airwallex.com/assets/elements.bundle.min.js"></script>
</head>
<body>
  <div class="neural-grid"></div>
  <div class="particles" id="particles"></div>

  <!-- ===== NAVIGATION ===== -->
  <nav class="nav" id="mainNav">
    <a href="#" class="logo" onclick="showPage('landing')">
      <div class="logo-mark">LR</div>
      <span class="logo-text">LEADRIPPER</span>
    </a>
    <div class="nav-links">
      <a class="nav-link" onclick="scrollToSection('features')">
        <span>Features</span>
      </a>
      <a class="nav-link" onclick="scrollToSection('pricing')">
        <span>Pricing</span>
      </a>
      <a class="nav-link" href="blog.html">
        <span>Blog</span>
      </a>
      <a class="nav-link" href="#">
        <span>Documentation</span>
      </a>
    </div>
    <div class="nav-actions" id="navActions">
      <button class="btn btn-ghost" onclick="showPage('login')">
        <span>SIGN IN</span>
      </button>
      <button class="btn btn-primary" onclick="showPage('register')">
        <span>GET STARTED</span>
      </button>
    </div>
  </nav>

  <!-- ===== LANDING PAGE ===== -->
  <div class="page active" id="page-landing">
    <section class="hero">
      <div class="hero-badge">
        <span class="hero-badge-dot"></span>
        <span>AI-Powered Lead Generation</span>
      </div>
      <h1>
        Turn Any Market Into<br>
        <span class="gradient">Qualified Leads</span>
      </h1>
      <p class="hero-subtitle">
        LeadRipper uses advanced AI agents to scrape, verify, and enrich business leads from any industry and location. Sync directly to GoHighLevel in seconds.
      </p>
      <div class="hero-cta">
        <button class="btn btn-primary btn-lg" onclick="showPage('register')">
          Start Free Trial
        </button>
        <button class="btn btn-outline btn-lg" onclick="scrollToSection('features')">
          See How It Works
        </button>
      </div>
      <div class="hero-stats">
        <div class="hero-stat">
          <div class="hero-stat-value">2.5M+</div>
          <div class="hero-stat-label">Leads Generated</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-value">15K+</div>
          <div class="hero-stat-label">Active Users</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-value">98%</div>
          <div class="hero-stat-label">Email Accuracy</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-value">50+</div>
          <div class="hero-stat-label">Industries</div>
        </div>
      </div>
    </section>

    <section class="features" id="features">
      <div class="section-header">
        <div class="section-label">Features</div>
        <h2 class="section-title">Everything You Need to Scale</h2>
        <p class="section-subtitle">Built for agencies and businesses who want predictable, high-quality leads.</p>
      </div>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">&#x1F916;</div>
          <h3>AI-Powered Scraping</h3>
          <p>Our intelligent agents search Google Maps, Yelp, and industry directories to find businesses matching your exact criteria.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">&#x2705;</div>
          <h3>Email Verification</h3>
          <p>Every lead is verified in real-time. No more bounced emails or wasted outreach efforts.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">&#x1F517;</div>
          <h3>GHL Integration</h3>
          <p>One-click sync to your GoHighLevel account. Leads flow directly into your pipelines and workflows.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">&#x1F4CA;</div>
          <h3>Smart Deduplication</h3>
          <p>Never scrape the same lead twice. Our system tracks every city and industry combination you've searched.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">&#x1F680;</div>
          <h3>Bulk Operations</h3>
          <p>Scrape hundreds of cities at once. Queue jobs and let the AI work while you focus on closing deals.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">&#x1F512;</div>
          <h3>GDPR Compliant</h3>
          <p>We only collect publicly available business information. Stay compliant while scaling your outreach.</p>
        </div>
      </div>
    </section>

    <section class="pricing" id="pricing">
      <div class="section-header">
        <div class="section-label">Pricing</div>
        <h2 class="section-title">Simple, Transparent Pricing</h2>
        <p class="section-subtitle">Try any plan for just $1 for 7 days. Cancel anytime.</p>
      </div>

      <!-- Billing Toggle -->
      <div class="pricing-toggle">
        <span class="pricing-toggle-label active" data-billing="monthly">Monthly</span>
        <div class="pricing-toggle-switch" onclick="toggleBilling()"></div>
        <span class="pricing-toggle-label" data-billing="annual">Annual</span>
        <span class="pricing-save-badge">Save 20%</span>
      </div>

      <div class="pricing-grid">
        <!-- Starter Plan -->
        <div class="pricing-card" data-plan="starter">
          <div class="trial-badge">$1 for 7 days</div>
          <div class="pricing-name">Starter</div>
          <div class="pricing-desc">Start extracting today</div>
          <div class="pricing-price">
            <span class="pricing-currency">$</span>
            <span class="pricing-amount" data-monthly="29" data-annual="23">29</span>
            <span class="pricing-period">/month</span>
          </div>
          <div class="pricing-billed" data-monthly="Billed monthly" data-annual="$276 billed annually">Billed monthly</div>
          <ul class="pricing-features">
            <li><span class="check">&#x2713;</span> 500 leads/month</li>
            <li><span class="check">&#x2713;</span> CSV export</li>
            <li><span class="check">&#x2713;</span> Email support</li>
            <li><span class="check">&#x2713;</span> City tracking</li>
            <li><span class="check">&#x2713;</span> Deduplication</li>
          </ul>
          <button class="btn btn-outline" style="width: 100%;" onclick="startTrial('starter')">Start $1 Trial</button>
        </div>

        <!-- Advanced Plan -->
        <div class="pricing-card featured" data-plan="advanced">
          <div class="trial-badge">$1 for 7 days</div>
          <div class="pricing-name">Advanced</div>
          <div class="pricing-desc">Most popular</div>
          <div class="pricing-price">
            <span class="pricing-currency">$</span>
            <span class="pricing-amount" data-monthly="79" data-annual="63">79</span>
            <span class="pricing-period">/month</span>
          </div>
          <div class="pricing-billed" data-monthly="Billed monthly" data-annual="$756 billed annually">Billed monthly</div>
          <ul class="pricing-features">
            <li><span class="check">&#x2713;</span> 2,500 leads/month</li>
            <li><span class="check">&#x2713;</span> GHL sync included</li>
            <li><span class="check">&#x2713;</span> Priority support</li>
            <li><span class="check">&#x2713;</span> Email verification</li>
            <li><span class="check">&#x2713;</span> Webhook notifications</li>
            <li><span class="check">&#x2713;</span> Bulk operations</li>
          </ul>
          <button class="btn btn-primary" style="width: 100%;" onclick="startTrial('advanced')">Start $1 Trial</button>
        </div>

        <!-- Premium Plan -->
        <div class="pricing-card" data-plan="premium">
          <div class="trial-badge">$1 for 7 days</div>
          <div class="pricing-name">Premium</div>
          <div class="pricing-desc">For larger teams</div>
          <div class="pricing-price">
            <span class="pricing-currency">$</span>
            <span class="pricing-amount" data-monthly="149" data-annual="119">149</span>
            <span class="pricing-period">/month</span>
          </div>
          <div class="pricing-billed" data-monthly="Billed monthly" data-annual="$1,428 billed annually">Billed monthly</div>
          <ul class="pricing-features">
            <li><span class="check">&#x2713;</span> 10,000 leads/month</li>
            <li><span class="check">&#x2713;</span> Everything in Advanced</li>
            <li><span class="check">&#x2713;</span> API access</li>
            <li><span class="check">&#x2713;</span> Custom webhooks</li>
            <li><span class="check">&#x2713;</span> Dedicated support</li>
            <li><span class="check">&#x2713;</span> Team collaboration</li>
          </ul>
          <button class="btn btn-outline" style="width: 100%;" onclick="startTrial('premium')">Start $1 Trial</button>
        </div>

        <!-- Unlimited Plan -->
        <div class="pricing-card" data-plan="unlimited">
          <div class="trial-badge">$1 for 7 days</div>
          <div class="pricing-name">Unlimited</div>
          <div class="pricing-desc">Scrape entire markets</div>
          <div class="pricing-price">
            <span class="pricing-currency">$</span>
            <span class="pricing-amount" data-monthly="997" data-annual="797">997</span>
            <span class="pricing-period">/month</span>
          </div>
          <div class="pricing-billed" data-monthly="Billed monthly" data-annual="$9,564 billed annually">Billed monthly</div>
          <ul class="pricing-features">
            <li><span class="check">&#x2713;</span> Unlimited leads</li>
            <li><span class="check">&#x2713;</span> Scrape entire US</li>
            <li><span class="check">&#x2713;</span> Everything in Premium</li>
            <li><span class="check">&#x2713;</span> White-label exports</li>
            <li><span class="check">&#x2713;</span> Custom integrations</li>
            <li><span class="check">&#x2713;</span> Priority processing</li>
          </ul>
          <button class="btn btn-primary" style="width: 100%;" onclick="startTrial('unlimited')">Start $1 Trial</button>
        </div>
      </div>

      <!-- Lifetime Deals Section -->
      <div class="lifetime-section">
        <div class="lifetime-badge">LIMITED TIME OFFER</div>
        <h3 class="lifetime-title">Lifetime Access Deals</h3>
        <p class="lifetime-subtitle">Pay once, use forever. No recurring fees. Limited spots available.</p>

        <div class="lifetime-grid">
          <!-- Lifetime Basic -->
          <div class="lifetime-card">
            <div class="lifetime-card-name">Lifetime Basic</div>
            <div class="lifetime-card-spots urgent">Only <span id="basic-spots-left">100</span> of 100 spots left</div>
            <div class="lifetime-card-price">
              <span class="currency">$</span>
              <span class="amount">99</span>
            </div>
            <div class="lifetime-card-onetime">One-time payment</div>
            <ul class="lifetime-features">
              <li><span class="check">&#x2713;</span> Standard plan features forever</li>
              <li><span class="check">&#x2713;</span> 500 leads/month</li>
              <li><span class="check">&#x2713;</span> All future updates</li>
              <li><span class="check">&#x2713;</span> Priority email support</li>
            </ul>
            <button class="btn btn-outline" style="width: 100%;" onclick="buyLifetime('basic')">Get Lifetime Basic</button>
            <div class="spots-counter">
              <div class="spots-bar"><div class="spots-bar-fill" id="basic-bar" style="width: 100%"></div></div>
              <span class="spots-text" id="basic-spots-text">100 left</span>
            </div>
          </div>

          <!-- Lifetime Pro -->
          <div class="lifetime-card pro">
            <div class="lifetime-card-name">Lifetime Pro</div>
            <div class="lifetime-card-spots">Only <span id="pro-spots-left">1000</span> of 1000 spots left</div>
            <div class="lifetime-card-price">
              <span class="currency">$</span>
              <span class="amount">999</span>
            </div>
            <div class="lifetime-card-onetime">One-time payment</div>
            <ul class="lifetime-features">
              <li><span class="check">&#x2713;</span> Business plan features forever</li>
              <li><span class="check">&#x2713;</span> 10,000 leads/month</li>
              <li><span class="check">&#x2713;</span> All future updates</li>
              <li><span class="check">&#x2713;</span> Priority support</li>
              <li><span class="check">&#x2713;</span> API access included</li>
            </ul>
            <button class="btn btn-primary" style="width: 100%;" onclick="buyLifetime('pro')">Get Lifetime Pro</button>
            <div class="spots-counter">
              <div class="spots-bar"><div class="spots-bar-fill" id="pro-bar" style="width: 100%"></div></div>
              <span class="spots-text" id="pro-spots-text">1000 left</span>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- ===== LOGIN PAGE ===== -->
  <div class="page" id="page-login">
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <div class="logo" style="justify-content: center; margin-bottom: 24px;">
            <div class="logo-mark">LF</div>
          </div>
          <h2>Welcome back</h2>
          <p>Sign in to access your dashboard</p>
        </div>
        <form id="loginForm" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="loginEmail" placeholder="you@company.com" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password" required>
          </div>
          <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;" id="loginBtn">
            Sign In
          </button>
        </form>
        <div class="auth-footer">
          Don't have an account? <a href="#" onclick="showPage('register')">Sign up</a>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== REGISTER PAGE ===== -->
  <div class="page" id="page-register">
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <div class="logo" style="justify-content: center; margin-bottom: 24px;">
            <div class="logo-mark">LF</div>
          </div>
          <h2>Create your account</h2>
          <p>Start your $1 trial today</p>
        </div>
        <form id="registerForm" onsubmit="handleRegister(event)">
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-input" id="registerName" placeholder="John Doe" required>
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="registerEmail" placeholder="you@company.com" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-input" id="registerPassword" placeholder="Create a password" required minlength="8">
            <p class="form-hint">Must be at least 8 characters</p>
          </div>
          <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;" id="registerBtn">
            Create Account
          </button>
        </form>
        <div class="auth-footer">
          Already have an account? <a href="#" onclick="showPage('login')">Sign in</a>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== TRIAL SIGNUP ===== -->
  <div class="page" id="page-trial">
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <div class="logo" style="justify-content: center; margin-bottom: 24px;">
            <div class="logo-mark mono">LR</div>
          </div>
          <h2>Start Your $1 Trial</h2>
          <p>Create account & pay in one step</p>
        </div>
        <div id="trialError" class="error-message" style="display: none;"></div>
        <form id="trialForm" onsubmit="handleTrialSignup(event)">
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-input mono" id="trialName" placeholder="John Doe" required>
          </div>
          <div class="form-group">
            <label class="form-label">Company (Optional)</label>
            <input type="text" class="form-input mono" id="trialCompany" placeholder="Your Company">
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input mono" id="trialEmail" placeholder="you@company.com" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-input mono" id="trialPassword" placeholder="Create a password" required minlength="8">
            <p class="form-hint">Must be at least 8 characters</p>
          </div>
          <div class="form-group">
            <label class="form-label">Select Plan</label>
            <select class="form-input mono" id="trialPlan" required>
              <option value="starter">Starter - $29/mo (500 leads) - $1 Trial</option>
              <option value="advanced" selected>Advanced - $79/mo (2,500 leads) - $1 Trial</option>
              <option value="premium">Premium - $149/mo (10,000 leads) - $1 Trial</option>
              <option value="unlimited">Unlimited - $997/mo (âˆž leads) - $1 Trial</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;" id="trialBtn">
            Continue to Payment ($1)
          </button>
        </form>
        <div class="auth-footer">
          Already have an account? <a href="#" onclick="showPage('login')">Sign in</a>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== DASHBOARD ===== -->
  <div class="page" id="page-dashboard">
    <div class="dashboard">
      <aside class="sidebar" id="sidebar">
        <a href="#" class="sidebar-logo" onclick="showPage('landing')">
          <div class="logo-mark">LF</div>
          <span class="logo-text">LeadRipper</span>
        </a>
        <nav class="sidebar-nav">
          <div class="sidebar-section">
            <div class="sidebar-section-title">Main</div>
            <a class="sidebar-link active" data-view="overview" onclick="showDashboardView('overview')">
              <span class="sidebar-link-icon">&#x1F4CA;</span>
              <span>Overview</span>
            </a>
            <a class="sidebar-link" data-view="scrape" onclick="showDashboardView('scrape')">
              <span class="sidebar-link-icon">&#x1F50D;</span>
              <span>Scrape Leads</span>
            </a>
            <a class="sidebar-link" data-view="leads" onclick="showDashboardView('leads')">
              <span class="sidebar-link-icon">&#x1F465;</span>
              <span>My Leads</span>
            </a>
          </div>
          <div class="sidebar-section">
            <div class="sidebar-section-title">Integrations</div>
            <a class="sidebar-link" data-view="ghl" onclick="showDashboardView('ghl')">
              <span class="sidebar-link-icon">&#x1F517;</span>
              <span>GoHighLevel</span>
            </a>
          </div>
          <div class="sidebar-section">
            <div class="sidebar-section-title">Account</div>
            <a class="sidebar-link" data-view="settings" onclick="showDashboardView('settings')">
              <span class="sidebar-link-icon">&#x2699;</span>
              <span>Settings</span>
            </a>
            <a class="sidebar-link" data-view="billing" onclick="showDashboardView('billing')">
              <span class="sidebar-link-icon">&#x1F4B3;</span>
              <span>Billing</span>
            </a>
          </div>
          <div class="sidebar-section admin-section" id="adminSection" style="display: none;">
            <div class="sidebar-section-title" style="color: var(--accent-danger);">Admin</div>
            <a class="sidebar-link" data-view="admin" onclick="showDashboardView('admin')">
              <span class="sidebar-link-icon">&#x1F6E1;</span>
              <span>User Management</span>
            </a>
          </div>
        </nav>
        <div class="sidebar-user">
          <div class="sidebar-user-avatar" id="userAvatar">B</div>
          <div class="sidebar-user-info">
            <div class="sidebar-user-name" id="userName">Ben</div>
            <div class="sidebar-user-plan">Professional Plan</div>
          </div>
          <button class="btn btn-ghost btn-sm" onclick="logout()" style="margin-top: 12px; width: 100%; font-size: 13px;" title="Sign out">
            <span>&#x1F6AA;</span> Sign Out
          </button>
        </div>
      </aside>

      <main class="main-content">
        <!-- Overview View -->
        <div class="dashboard-view active" id="view-overview">
          <div class="page-header">
            <div>
              <h1 class="page-title">Dashboard</h1>
              <p class="page-subtitle">Welcome back! Here's your lead generation overview.</p>
            </div>
            <button class="btn btn-primary" onclick="showDashboardView('scrape')">
              <span>&#x2795;</span> New Scrape
            </button>
          </div>

          <div class="stats-row">
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon">&#x1F465;</div>
                <span class="stat-card-trend up">+12%</span>
              </div>
              <div class="stat-card-value" id="statTotalLeads">0</div>
              <div class="stat-card-label">Total Leads</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon">&#x1F3D9;</div>
              </div>
              <div class="stat-card-value" id="statCitiesScraped">0</div>
              <div class="stat-card-label">Cities Scraped</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon">&#x2705;</div>
              </div>
              <div class="stat-card-value" id="statVerifiedEmails">0</div>
              <div class="stat-card-label">Verified Emails</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon">&#x1F504;</div>
              </div>
              <div class="stat-card-value" id="statGhlSynced">0</div>
              <div class="stat-card-label">Synced to GHL</div>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
            <div class="panel">
              <div class="panel-header">
                <h3 class="panel-title">Recent Activity</h3>
              </div>
              <div class="panel-body" id="recentActivity">
                <div class="empty-state">
                  <div class="empty-state-icon">&#x1F4C8;</div>
                  <div class="empty-state-title">No activity yet</div>
                  <div class="empty-state-text">Start scraping leads to see your activity here</div>
                </div>
              </div>
            </div>

            <div class="panel">
              <div class="panel-header">
                <h3 class="panel-title">Top Industries</h3>
              </div>
              <div class="panel-body" id="topIndustries">
                <div class="empty-state">
                  <div class="empty-state-icon">&#x1F3ED;</div>
                  <div class="empty-state-title">No data yet</div>
                  <div class="empty-state-text">Scrape leads to see industry breakdown</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Scrape View -->
        <div class="dashboard-view" id="view-scrape">
          <div class="page-header">
            <div>
              <h1 class="page-title">Scrape Leads</h1>
              <p class="page-subtitle">Find high-quality leads from any industry and location</p>
            </div>
          </div>

          <div class="panel">
            <div class="panel-header">
              <h3 class="panel-title">Configure Your Search</h3>
            </div>
            <div class="panel-body">
              <div class="scrape-controls">
                <div class="form-group">
                  <label class="form-label">Industry</label>
                  <div class="select-wrapper">
                    <select class="form-select" id="scrapeIndustry">
                      <option value="">Select an industry...</option>
                      <option value="dentist">Dentists</option>
                      <option value="lawyer">Lawyers</option>
                      <option value="doctor">Doctors</option>
                      <option value="chiropractor">Chiropractors</option>
                      <option value="plumber">Plumbers</option>
                      <option value="electrician">Electricians</option>
                      <option value="hvac">HVAC Companies</option>
                      <option value="roofing">Roofing Companies</option>
                      <option value="restaurant">Restaurants</option>
                      <option value="gym">Gyms & Fitness</option>
                      <option value="realtor">Real Estate Agents</option>
                      <option value="accountant">Accountants</option>
                      <option value="salon">Hair Salons</option>
                      <option value="spa">Spas & Wellness</option>
                      <option value="veterinarian">Veterinarians</option>
                      <option value="auto_repair">Auto Repair Shops</option>
                      <option value="insurance">Insurance Agents</option>
                      <option value="landscaping">Landscaping</option>
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">Max Results Per City</label>
                  <div class="select-wrapper">
                    <select class="form-select" id="scrapeMaxResults">
                      <option value="25">25 results</option>
                      <option value="50" selected>50 results</option>
                      <option value="100">100 results</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Cities (Press Enter to add)</label>
                <div class="tags-input-wrapper" id="cityTagsWrapper">
                  <input type="text" class="tags-input" id="cityInput" placeholder="e.g., Austin, TX">
                </div>
                <p class="form-hint">Add multiple cities to scrape in batch. Previously scraped cities will be highlighted.</p>
              </div>

              <button class="btn btn-primary btn-lg" id="startScrapeBtn" onclick="startScrape()" disabled>
                <span>&#x1F50D;</span> Start Scraping
              </button>

              <div class="progress-container" id="scrapeProgress">
                <div class="progress-bar-wrapper">
                  <div class="progress-bar" id="scrapeProgressBar"></div>
                </div>
                <div class="progress-text" id="scrapeProgressText">Initializing...</div>
              </div>
            </div>
          </div>

          <div class="panel" style="margin-top: 24px;">
            <div class="panel-header">
              <h3 class="panel-title">Scrape Results</h3>
              <div style="display: flex; gap: 12px;">
                <button class="btn btn-secondary btn-sm" id="exportCsvBtn" onclick="exportToCsv()" disabled>
                  Export CSV
                </button>
                <button class="btn btn-primary btn-sm" id="syncGhlBtn" onclick="syncToGhl()" disabled>
                  Sync to GHL
                </button>
              </div>
            </div>
            <div class="panel-body" id="scrapeResults">
              <div class="empty-state">
                <div class="empty-state-icon">&#x1F50E;</div>
                <div class="empty-state-title">No results yet</div>
                <div class="empty-state-text">Configure your search above and click "Start Scraping"</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Leads View -->
        <div class="dashboard-view" id="view-leads">
          <div class="page-header">
            <div>
              <h1 class="page-title">My Leads</h1>
              <p class="page-subtitle">View and manage all your scraped leads</p>
            </div>
            <div style="display: flex; gap: 12px;">
              <button class="btn btn-secondary" onclick="exportAllLeadsToCsv()">
                <span>&#x1F4E5;</span> Export All
              </button>
              <button class="btn btn-secondary" onclick="scrapeAllEmails()" id="scrapeAllEmailsBtn">
                <span>&#x1F4E7;</span> Scrape All Emails
              </button>
              <button class="btn btn-primary" onclick="syncAllToGhl()">
                <span>&#x1F504;</span> Sync All to GHL
              </button>
            </div>
          </div>

          <div class="panel">
            <div class="panel-body" id="allLeads">
              <div class="empty-state">
                <div class="empty-state-icon">&#x1F4C2;</div>
                <div class="empty-state-title">No leads yet</div>
                <div class="empty-state-text">Your scraped leads will appear here</div>
              </div>
            </div>
          </div>
        </div>

        <!-- GHL Integration View -->
        <div class="dashboard-view" id="view-ghl">
          <div class="page-header">
            <div>
              <h1 class="page-title">GoHighLevel Integration</h1>
              <p class="page-subtitle">Connect your GHL account to sync leads automatically</p>
            </div>
          </div>

          <div class="panel">
            <div class="panel-body">
              <div class="settings-section">
                <div class="settings-section-title">API Configuration</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">GHL API Key</div>
                    <div class="settings-hint">Enter your GoHighLevel API key to enable lead syncing. You can find this in your GHL settings under API Keys.</div>
                  </div>
                  <div class="settings-input-col">
                    <div class="api-key-input">
                      <input type="password" class="form-input" id="ghlApiKey" placeholder="eyJhbGciOiJIUzI1NiIs...">
                      <button class="btn btn-secondary" onclick="saveGhlKey()">Save</button>
                    </div>
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Location ID</div>
                    <div class="settings-hint">Your GHL Location ID determines where leads will be synced.</div>
                  </div>
                  <div class="settings-input-col">
                    <div class="api-key-input">
                      <input type="text" class="form-input" id="ghlLocationId" placeholder="fl5rL3eZQWBq2GYlDPkl">
                      <button class="btn btn-secondary" onclick="saveGhlLocation()">Save</button>
                    </div>
                  </div>
                </div>
                <div class="settings-row" style="margin-top: 16px;">
                  <div class="settings-label-col">
                    <div class="settings-label">Load Pipelines</div>
                    <div class="settings-hint">After saving your API key and Location ID, click to load your pipelines</div>
                  </div>
                  <div class="settings-input-col">
                    <button class="btn btn-primary" id="fetchPipelinesBtn" onclick="fetchGhlPipelines()">
                      Fetch Pipelines from GHL
                    </button>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Sync Settings</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Auto-sync new leads</div>
                    <div class="settings-hint">Automatically sync leads to GHL when scraping completes</div>
                  </div>
                  <div class="settings-input-col">
                    <label class="toggle">
                      <input type="checkbox" id="ghlAutoSync">
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Default Pipeline</div>
                    <div class="settings-hint">Select the pipeline where new leads will be added</div>
                  </div>
                  <div class="settings-input-col">
                    <div class="select-wrapper">
                      <select class="form-select" id="ghlPipeline" onchange="onPipelineChange()">
                        <option value="">-- Select Pipeline --</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Default Stage</div>
                    <div class="settings-hint">Select the stage where new leads will start</div>
                  </div>
                  <div class="settings-input-col">
                    <div class="select-wrapper">
                      <select class="form-select" id="ghlStage" onchange="saveDefaultPipelineAndStage()">
                        <option value="">-- Select Stage --</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Industry-Specific Pipelines</div>
                <div class="settings-hint" style="margin-bottom: 16px;">Configure different pipelines for each industry. Leads will be routed to the appropriate pipeline when synced.</div>

                <div id="industryPipelinesContainer">
                  <!-- Industry pipeline rows will be added dynamically -->
                </div>

                <div style="margin-top: 16px;">
                  <button class="btn btn-secondary btn-sm" onclick="addIndustryPipeline()">
                    + Add Industry Pipeline
                  </button>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Connection Status</div>
                <div id="ghlStatus" style="display: flex; align-items: center; gap: 12px;">
                  <span class="badge badge-warning">Not Connected</span>
                  <span style="color: var(--text-secondary); font-size: 14px;">Enter your API key to connect</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings View -->
        <div class="dashboard-view" id="view-settings">
          <div class="page-header">
            <div>
              <h1 class="page-title">Settings</h1>
              <p class="page-subtitle">Manage your account preferences and integrations</p>
            </div>
          </div>

          <div class="panel">
            <div class="panel-body">
              <div class="settings-section">
                <div class="settings-section-title">Profile</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Full Name</div>
                  </div>
                  <div class="settings-input-col">
                    <input type="text" class="form-input" id="settingsName" placeholder="Your name">
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Company</div>
                  </div>
                  <div class="settings-input-col">
                    <input type="text" class="form-input" id="settingsCompany" placeholder="Your company">
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Email</div>
                  </div>
                  <div class="settings-input-col">
                    <input type="email" class="form-input" id="settingsEmail" disabled>
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col"></div>
                  <div class="settings-input-col">
                    <button class="btn btn-primary" onclick="saveProfile()">Save Profile</button>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Email Integration (Resend)</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Resend API Key</div>
                    <div class="settings-hint">Connect Resend to send email campaigns to your leads. Get your API key at <a href="https://resend.com" target="_blank" style="color: var(--accent-primary);">resend.com</a></div>
                  </div>
                  <div class="settings-input-col">
                    <div class="api-key-input">
                      <input type="password" class="form-input" id="resendApiKey" placeholder="re_xxxxxxxxxxxx">
                      <button class="btn btn-secondary" onclick="saveResendKey()">Save</button>
                    </div>
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Connection Status</div>
                  </div>
                  <div class="settings-input-col">
                    <div id="resendStatus" style="display: flex; align-items: center; gap: 12px;">
                      <span class="badge badge-warning">Not Connected</span>
                      <span style="color: var(--text-secondary); font-size: 14px;">Enter your API key to connect</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Webhooks</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Webhook URL</div>
                    <div class="settings-hint">Receive real-time notifications when new leads are scraped</div>
                  </div>
                  <div class="settings-input-col">
                    <div class="api-key-input">
                      <input type="url" class="form-input" id="webhookUrl" placeholder="https://your-webhook-url.com/endpoint">
                      <button class="btn btn-secondary" onclick="saveWebhookUrl()">Save</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Security</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Change Password</div>
                  </div>
                  <div class="settings-input-col">
                    <button class="btn btn-secondary">Update Password</button>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Danger Zone</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Delete Account</div>
                    <div class="settings-hint">Permanently delete your account and all associated data</div>
                  </div>
                  <div class="settings-input-col">
                    <button class="btn btn-outline" style="border-color: var(--accent-danger); color: var(--accent-danger);">Delete Account</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Billing View -->
        <div class="dashboard-view" id="view-billing">
          <div class="page-header">
            <div>
              <h1 class="page-title">Billing</h1>
              <p class="page-subtitle">Manage your subscription and payment methods</p>
            </div>
          </div>

          <div class="panel">
            <div class="panel-body">
              <div class="settings-section">
                <div class="settings-section-title">Current Plan</div>
                <div id="currentPlanDisplay" style="display: flex; align-items: center; justify-content: space-between; padding: 24px; background: var(--bg-elevated); border-radius: 12px;">
                  <div>
                    <div id="planName" style="font-family: 'Syne', sans-serif; font-size: 24px; font-weight: 700; margin-bottom: 4px;">Free</div>
                    <div id="planFeatures" style="color: var(--text-secondary);">50 leads/month &bull; Limited features</div>
                    <div id="planStatus" style="font-size: 14px; color: var(--text-muted); margin-top: 8px;"></div>
                  </div>
                  <div style="text-align: right;">
                    <div id="planPrice" style="font-family: 'Space Mono', monospace; font-size: 32px; font-weight: 700;">$0<span style="font-size: 16px; color: var(--text-muted);">/mo</span></div>
                    <button id="cancelPlanBtn" class="btn btn-ghost" style="margin-top: 12px; font-size: 14px; padding: 8px 16px; display: none; color: #ff4444;" onclick="showCancelModal()">Cancel Subscription</button>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Usage This Period</div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                  <div style="padding: 20px; background: var(--bg-elevated); border-radius: 12px;">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">Leads Used</div>
                    <div style="font-family: 'Space Mono', monospace; font-size: 24px; font-weight: 700;"><span id="billingLeadsUsed">0</span> <span id="billingLeadsLimit" style="font-size: 14px; color: var(--text-muted);">/ 50</span></div>
                    <div style="height: 4px; background: var(--bg-surface); border-radius: 2px; margin-top: 12px;">
                      <div id="leadsProgressBar" style="height: 100%; width: 0%; background: var(--gradient-primary); border-radius: 2px;"></div>
                    </div>
                  </div>
                  <div style="padding: 20px; background: var(--bg-elevated); border-radius: 12px;">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">GHL Syncs</div>
                    <div id="billingGhlSyncs" style="font-family: 'Space Mono', monospace; font-size: 24px; font-weight: 700;">0</div>
                  </div>
                  <div style="padding: 20px; background: var(--bg-elevated); border-radius: 12px;">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">Cities Scraped</div>
                    <div id="billingCitiesScraped" style="font-family: 'Space Mono', monospace; font-size: 24px; font-weight: 700;">0</div>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Start Your Trial</div>
                <div style="padding: 24px; background: linear-gradient(135deg, rgba(255, 62, 0, 0.1) 0%, rgba(255, 62, 0, 0.1) 100%); border-radius: 12px; border: 2px solid var(--accent-primary); margin-bottom: 24px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                    <div>
                      <div style="font-family: 'Syne', sans-serif; font-size: 24px; font-weight: 700; margin-bottom: 4px;">7-Day Full Access Trial</div>
                      <div style="color: var(--text-secondary);">Try everything LeadRipper has to offer</div>
                      <ul style="list-style: none; margin-top: 12px; font-size: 14px; color: var(--text-secondary);">
                        <li style="padding: 4px 0;">&#x2713; 500 leads included</li>
                        <li style="padding: 4px 0;">&#x2713; GHL integration</li>
                        <li style="padding: 4px 0;">&#x2713; CSV export</li>
                        <li style="padding: 4px 0;">&#x2713; Email scraping</li>
                      </ul>
                    </div>
                    <div style="text-align: center;">
                      <div style="font-family: 'Space Mono', monospace; font-size: 48px; font-weight: 700; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">$1</div>
                      <div style="font-size: 14px; color: var(--text-muted);">for 7 days</div>
                      <button class="btn btn-primary" style="margin-top: 12px; padding: 12px 32px;" onclick="upgradePlan('starter')">Start Trial</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Monthly Plans</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                  <div style="padding: 24px; background: var(--bg-elevated); border-radius: 12px; border: 1px solid var(--border-medium);">
                    <div style="font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 700; margin-bottom: 8px;">Basic</div>
                    <div style="font-family: 'Space Mono', monospace; font-size: 28px; font-weight: 700; margin-bottom: 12px;">$29<span style="font-size: 14px; color: var(--text-muted);">/mo</span></div>
                    <ul style="list-style: none; margin-bottom: 20px; font-size: 14px; color: var(--text-secondary);">
                      <li style="padding: 6px 0;">&#x2713; 500 leads/month</li>
                      <li style="padding: 6px 0;">&#x2713; GHL sync</li>
                      <li style="padding: 6px 0;">&#x2713; CSV export</li>
                      <li style="padding: 6px 0;">&#x2713; Email support</li>
                    </ul>
                    <button class="btn btn-outline" style="width: 100%;" onclick="upgradePlan('basic')">Select Plan</button>
                  </div>
                  <div style="padding: 24px; background: var(--bg-elevated); border-radius: 12px; border: 2px solid var(--accent-primary);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                      <div style="font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 700;">Advanced</div>
                      <span style="background: var(--accent-primary); color: var(--bg-void); padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">POPULAR</span>
                    </div>
                    <div style="font-family: 'Space Mono', monospace; font-size: 28px; font-weight: 700; margin-bottom: 12px;">$79<span style="font-size: 14px; color: var(--text-muted);">/mo</span></div>
                    <ul style="list-style: none; margin-bottom: 20px; font-size: 14px; color: var(--text-secondary);">
                      <li style="padding: 6px 0;">&#x2713; 2,500 leads/month</li>
                      <li style="padding: 6px 0;">&#x2713; Everything in Basic</li>
                      <li style="padding: 6px 0;">&#x2713; Email verification</li>
                      <li style="padding: 6px 0;">&#x2713; Priority support</li>
                    </ul>
                    <button class="btn btn-primary" style="width: 100%;" onclick="upgradePlan('advanced')">Select Plan</button>
                  </div>
                  <div style="padding: 24px; background: var(--bg-elevated); border-radius: 12px; border: 1px solid var(--border-medium);">
                    <div style="font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 700; margin-bottom: 8px;">Premium</div>
                    <div style="font-family: 'Space Mono', monospace; font-size: 28px; font-weight: 700; margin-bottom: 12px;">$149<span style="font-size: 14px; color: var(--text-muted);">/mo</span></div>
                    <ul style="list-style: none; margin-bottom: 20px; font-size: 14px; color: var(--text-secondary);">
                      <li style="padding: 6px 0;">&#x2713; 10,000 leads/month</li>
                      <li style="padding: 6px 0;">&#x2713; Everything in Advanced</li>
                      <li style="padding: 6px 0;">&#x2713; API access</li>
                      <li style="padding: 6px 0;">&#x2713; Webhooks</li>
                    </ul>
                    <button class="btn btn-outline" style="width: 100%;" onclick="upgradePlan('premium')">Select Plan</button>
                  </div>
                  <div style="padding: 24px; background: var(--bg-elevated); border-radius: 12px; border: 1px solid var(--accent-secondary);">
                    <div style="font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 700; margin-bottom: 8px;">Enterprise</div>
                    <div style="font-family: 'Space Mono', monospace; font-size: 28px; font-weight: 700; margin-bottom: 12px;">$297<span style="font-size: 14px; color: var(--text-muted);">/mo</span></div>
                    <ul style="list-style: none; margin-bottom: 20px; font-size: 14px; color: var(--text-secondary);">
                      <li style="padding: 6px 0;">&#x2713; Unlimited leads</li>
                      <li style="padding: 6px 0;">&#x2713; Everything in Premium</li>
                      <li style="padding: 6px 0;">&#x2713; White-label exports</li>
                      <li style="padding: 6px 0;">&#x2713; Dedicated support</li>
                    </ul>
                    <button class="btn btn-outline" style="width: 100%;" onclick="upgradePlan('enterprise')">Select Plan</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Admin View -->
        <div class="dashboard-view" id="view-admin">
          <div class="page-header">
            <div>
              <h1 class="page-title">Admin Dashboard</h1>
              <p class="page-subtitle">Manage users, subscriptions, and access control</p>
            </div>
            <button class="btn btn-primary" onclick="loadAdminUsers()">
              <span>&#x1F504;</span> Refresh
            </button>
          </div>

          <div class="panel">
            <div class="panel-header">
              <h3 class="panel-title">All Users (<span id="adminUserCount">0</span>)</h3>
              <div style="display: flex; gap: 12px;">
                <input type="text" id="adminSearchInput" placeholder="Search by email..." class="input-field" style="width: 250px;" oninput="filterAdminUsers()">
              </div>
            </div>
            <div class="panel-body" style="padding: 0;">
              <div style="overflow-x: auto;">
                <table class="leads-table" id="adminUsersTable" style="min-width: 1200px;">
                  <thead>
                    <tr>
                      <th>User</th>
                      <th>Plan</th>
                      <th>Leads</th>
                      <th>Status</th>
                      <th>Created</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="adminUsersBody">
                    <tr>
                      <td colspan="6" style="text-align: center; padding: 40px;">
                        <div class="empty-state">
                          <div class="empty-state-icon">&#x1F465;</div>
                          <div class="empty-state-title">Loading users...</div>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Admin Modals -->
          <div class="modal" id="adminActionModal" style="display: none;">
            <div class="modal-content" style="max-width: 500px;">
              <div class="modal-header">
                <h3 id="adminModalTitle">User Action</h3>
                <button class="modal-close" onclick="closeAdminModal()">&times;</button>
              </div>
              <div class="modal-body" id="adminModalBody">
              </div>
              <div class="modal-footer" id="adminModalFooter">
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Cancel Subscription Modal -->
  <div id="cancelModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center;">
    <div style="background: var(--bg-surface); border: 2px solid var(--border-medium); border-radius: 16px; padding: 40px; max-width: 500px; width: 90%;">
      <h2 style="font-family: 'Syne', sans-serif; font-size: 24px; font-weight: 700; margin-bottom: 16px; color: #ff4444;">Cancel Subscription?</h2>
      <p style="color: var(--text-secondary); margin-bottom: 24px; line-height: 1.6;">
        Your subscription will remain active until the end of your current billing period. After that, your account will be downgraded to the free plan.
      </p>
      <div id="cancelModalDetails" style="background: var(--bg-elevated); padding: 16px; border-radius: 8px; margin-bottom: 24px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <span style="color: var(--text-secondary);">Current Plan:</span>
          <span id="cancelModalPlan" style="font-weight: 600;">-</span>
        </div>
        <div style="display: flex; justify-content: space-between;">
          <span style="color: var(--text-secondary);">Access Until:</span>
          <span id="cancelModalDate" style="font-weight: 600;">-</span>
        </div>
      </div>
      <div style="display: flex; gap: 12px;">
        <button class="btn btn-ghost" style="flex: 1;" onclick="hideCancelModal()">Keep Subscription</button>
        <button class="btn btn-primary" style="flex: 1; background: #ff4444; border-color: #ff4444;" onclick="confirmCancelSubscription()">Yes, Cancel</button>
      </div>
    </div>
  </div>

  <script>
    // ===== APP STATE =====
    const state = {
      user: null,
      token: null,
      isAdmin: false,
      masquerade: null, // { active: bool, adminId, adminEmail }
      adminUsers: [], // For admin panel
      leads: [],
      leadsTotal: 0,
      leadsPage: 1,
      leadsPerPage: 50,
      scrapedCities: [],
      selectedCities: [],
      currentResults: [],
      ghlConfig: {
        apiKey: '',
        locationId: '',
        autoSync: false,
        pipelineId: '',
        stageId: '',
        industryPipelines: {} // { industry: { pipelineId, stageId } }
      },
      ghlPipelines: [] // Available pipelines from GHL API
    };

    // Common industries for pipeline mapping
    const COMMON_INDUSTRIES = [
      'Realtors', 'Real Estate Agents', 'Chiropractors', 'Plumbers',
      'HVAC', 'Electricians', 'Roofers', 'Landscapers', 'Dentists',
      'Lawyers', 'Accountants', 'Insurance Agents', 'Auto Dealers',
      'Restaurants', 'Gyms', 'Salons', 'Contractors', 'Painters',
      'Photographers', 'Wedding Planners', 'Pet Services', 'Cleaners'
    ];

    const API_BASE = '/.netlify/functions';

    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', () => {
      initParticles();
      setupCityInput();
      checkAuth();
      checkPaymentStatus();
    });

    // Check URL params for payment status
    async function checkPaymentStatus() {
      const urlParams = new URLSearchParams(window.location.search);
      const paymentStatus = urlParams.get('payment');
      const planId = urlParams.get('plan');
      const orderId = urlParams.get('order');

      if (paymentStatus === 'success') {
        // Clear URL params
        window.history.replaceState({}, document.title, window.location.pathname);

        // Check if this is a new trial signup
        const pendingUser = localStorage.getItem('leadripper_pending_user');
        if (pendingUser) {
          const userData = JSON.parse(pendingUser);
          localStorage.removeItem('leadripper_pending_user');

          try {
            // Auto-login the user
            const response = await fetch(`${API_BASE}/auth-login`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                email: userData.email,
                // We can't login without password, so we'll need to wait for webhook
                // Instead, show success and ask them to login
              })
            });

            showToast('success', 'Payment successful! Please check your email and login.');
            setTimeout(() => {
              showPage('login');
            }, 2000);
          } catch (error) {
            showToast('success', 'Payment successful! Please login with your credentials.');
            setTimeout(() => {
              showPage('login');
              // Pre-fill email
              document.getElementById('loginEmail').value = userData.email;
            }, 2000);
          }
        } else if (state.user) {
          // Existing user upgrading plan
          showToast('success', 'Payment successful! Your plan has been upgraded.');
          setTimeout(() => {
            checkAuth();
            showPage('billing');
          }, 1000);
        }
      } else if (paymentStatus === 'failed') {
        window.history.replaceState({}, document.title, window.location.pathname);
        showToast('error', 'Payment failed. Please try again.');
        const pendingUser = localStorage.getItem('leadripper_pending_user');
        if (pendingUser) {
          localStorage.removeItem('leadripper_pending_user');
          showPage('trial');
        } else {
          showPage('billing');
        }
      } else if (paymentStatus === 'cancelled') {
        window.history.replaceState({}, document.title, window.location.pathname);
        showToast('info', 'Payment was cancelled.');
        const pendingUser = localStorage.getItem('leadripper_pending_user');
        if (pendingUser) {
          localStorage.removeItem('leadripper_pending_user');
          showPage('trial');
        } else {
          showPage('billing');
        }
      }
    }

    // ===== PRICING & BILLING =====
    let currentBilling = 'monthly';

    function toggleBilling() {
      const toggle = document.querySelector('.pricing-toggle-switch');
      const labels = document.querySelectorAll('.pricing-toggle-label');
      const amounts = document.querySelectorAll('.pricing-amount[data-monthly]');
      const billedTexts = document.querySelectorAll('.pricing-billed[data-monthly]');

      if (currentBilling === 'monthly') {
        currentBilling = 'annual';
        toggle.classList.add('annual');
      } else {
        currentBilling = 'monthly';
        toggle.classList.remove('annual');
      }

      // Update labels
      labels.forEach(label => {
        label.classList.toggle('active', label.dataset.billing === currentBilling);
      });

      // Update prices
      amounts.forEach(amount => {
        amount.textContent = amount.dataset[currentBilling];
      });

      // Update billed text
      billedTexts.forEach(text => {
        text.textContent = text.dataset[currentBilling];
      });
    }

    // Pricing configuration
    const PRICING = {
      standard: {
        monthly: { trial: 100, full: 1000 }, // cents
        annual: { trial: 100, full: 9600 }
      },
      professional: {
        monthly: { trial: 100, full: 2000 },
        annual: { trial: 100, full: 19200 }
      },
      business: {
        monthly: { trial: 100, full: 9900 },
        annual: { trial: 100, full: 94800 }
      },
      lifetime_basic: { price: 9900 },
      lifetime_pro: { price: 99900 }
    };

    async function startTrial(plan) {
      if (!state.user) {
        // Redirect to trial signup page with pre-selected plan
        showPage('trial');
        // Pre-select the plan after page loads
        setTimeout(() => {
          const planSelect = document.getElementById('trialPlan');
          if (planSelect) {
            planSelect.value = plan;
          }
        }, 100);
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/create-checkout`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({
            plan: plan,
            billing: currentBilling,
            trial: true
          })
        });

        const data = await response.json();
        if (data.url) {
          window.location.href = data.url;
        } else {
          showToast('error', data.error || 'Failed to create checkout');
        }
      } catch (err) {
        showToast('error', 'Failed to start checkout');
        console.error(err);
      }
    }

    async function buyLifetime(type) {
      if (!state.user) {
        localStorage.setItem('selectedPlan', JSON.stringify({ plan: `lifetime_${type}`, billing: 'lifetime' }));
        showPage('register');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/create-checkout`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({
            plan: `lifetime_${type}`,
            billing: 'lifetime'
          })
        });

        const data = await response.json();
        if (data.url) {
          window.location.href = data.url;
        } else if (data.error === 'sold_out') {
          showToast('error', 'Sorry, this lifetime deal is sold out!');
        } else {
          showToast('error', data.error || 'Failed to create checkout');
        }
      } catch (err) {
        showToast('error', 'Failed to start checkout');
        console.error(err);
      }
    }

    // Load lifetime deal spots from server
    async function loadLifetimeSpots() {
      try {
        const response = await fetch(`${API_BASE}/get-lifetime-spots`);
        const data = await response.json();

        if (data.basic !== undefined) {
          updateSpotCounter('basic', data.basic, 100);
        }
        if (data.pro !== undefined) {
          updateSpotCounter('pro', data.pro, 1000);
        }
      } catch (err) {
        console.log('Could not load lifetime spots');
      }
    }

    function updateSpotCounter(type, remaining, total) {
      const spotsLeft = document.getElementById(`${type}-spots-left`);
      const spotsText = document.getElementById(`${type}-spots-text`);
      const bar = document.getElementById(`${type}-bar`);

      if (spotsLeft) spotsLeft.textContent = remaining;
      if (spotsText) spotsText.textContent = `${remaining} left`;
      if (bar) bar.style.width = `${(remaining / total) * 100}%`;

      // Add urgency styling if low
      if (remaining <= 10 && type === 'basic') {
        document.querySelector(`.lifetime-card:not(.pro) .lifetime-card-spots`)?.classList.add('urgent');
      }
      if (remaining <= 100 && type === 'pro') {
        document.querySelector(`.lifetime-card.pro .lifetime-card-spots`)?.classList.add('urgent');
      }
    }

    // Load spots on page load
    document.addEventListener('DOMContentLoaded', () => {
      loadLifetimeSpots();
    });

    // ===== PARTICLES EFFECT =====
    function initParticles() {
      const container = document.getElementById('particles');
      for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.animationDelay = `${Math.random() * 15}s`;
        particle.style.animationDuration = `${10 + Math.random() * 10}s`;
        container.appendChild(particle);
      }
    }

    // ===== NAVIGATION =====
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(`page-${pageId}`).classList.add('active');

      // Update nav based on auth state
      const navActions = document.getElementById('navActions');
      if (pageId === 'dashboard' && state.user) {
        navActions.innerHTML = `
          <button class="btn btn-ghost" onclick="logout()">Sign Out</button>
        `;
      } else if (pageId === 'landing') {
        navActions.innerHTML = `
          <button class="btn btn-ghost" onclick="showPage('login')">Sign In</button>
          <button class="btn btn-primary" onclick="showPage('register')">Get Started</button>
        `;
      }

      window.scrollTo(0, 0);
    }

    function showDashboardView(viewId) {
      document.querySelectorAll('.dashboard-view').forEach(v => v.classList.remove('active'));
      document.getElementById(`view-${viewId}`).classList.add('active');

      document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
      const activeLink = document.querySelector(`.sidebar-link[data-view="${viewId}"]`);
      if (activeLink) activeLink.classList.add('active');

      // Load admin users when switching to admin view
      if (viewId === 'admin' && state.isAdmin) {
        loadAdminUsers();
      }
    }

    function scrollToSection(sectionId) {
      document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
    }

    // ===== AUTH =====
    function checkAuth() {
      const token = localStorage.getItem('leadripper_token');
      const savedUser = localStorage.getItem('leadripper_user');
      if (token && savedUser) {
        state.token = token;
        state.user = JSON.parse(savedUser);
        updateUserUI();
        loadUserData();
        checkAdminStatus();
        checkMasquerade();
        // Navigate to dashboard if user is logged in
        showPage('dashboard');
      }
    }

    async function handleLogin(e) {
      e.preventDefault();
      const btn = document.getElementById('loginBtn');
      btn.classList.add('loading');
      btn.disabled = true;

      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      try {
        const response = await fetch(`${API_BASE}/auth-login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Login failed');
        }

        state.token = data.token;
        state.user = data.user;
        localStorage.setItem('leadripper_token', data.token);
        localStorage.setItem('leadripper_user', JSON.stringify(data.user));

        // Check trial status and show appropriate message
        if (data.user.trialExpired) {
          showToast('warning', 'Your free trial has expired. Please upgrade to continue using LeadRipper.');
          showPage('billing');
        } else if (data.user.isTrialActive && data.user.trialDaysRemaining) {
          showToast('success', `Welcome back! ${data.user.trialDaysRemaining} days left in your free trial.`);
          showPage('dashboard');
        } else {
          showToast('success', 'Welcome back!');
          showPage('dashboard');
        }
        updateUserUI();
        loadUserData();
        checkAdminStatus(); // Check if user is admin
      } catch (error) {
        showToast('error', error.message);
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    }

    async function handleRegister(e) {
      e.preventDefault();
      const btn = document.getElementById('registerBtn');
      btn.classList.add('loading');
      btn.disabled = true;

      const name = document.getElementById('registerName').value;
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;

      try {
        const response = await fetch(`${API_BASE}/auth-register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, name })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Registration failed');
        }

        state.token = data.token;
        state.user = data.user;
        localStorage.setItem('leadripper_token', data.token);
        localStorage.setItem('leadripper_user', JSON.stringify(data.user));

        showToast('success', 'Account created! You have a 3-day free trial with 500 leads. Enjoy!');
        updateUserUI();
        showPage('dashboard');
        loadUserData();
      } catch (error) {
        showToast('error', error.message);
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    }

    async function handleTrialSignup(e) {
      e.preventDefault();
      const btn = document.getElementById('trialBtn');
      const errorDiv = document.getElementById('trialError');

      btn.classList.add('loading');
      btn.disabled = true;
      errorDiv.style.display = 'none';

      const name = document.getElementById('trialName').value;
      const company = document.getElementById('trialCompany').value;
      const email = document.getElementById('trialEmail').value;
      const password = document.getElementById('trialPassword').value;
      const plan = document.getElementById('trialPlan').value;

      try {
        const response = await fetch(`${API_BASE}/trial-signup`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, name, company, plan })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Trial signup failed');
        }

        // Use Airwallex SDK to redirect to hosted payment page
        if (data.paymentIntentId && data.clientSecret) {
          showToast('success', 'Account created! Redirecting to payment...');
          // Store user data temporarily
          localStorage.setItem('leadripper_pending_user', JSON.stringify({
            email: data.email,
            userId: data.userId,
            plan: data.plan
          }));

          // Initialize Airwallex SDK
          Airwallex.init({
            env: 'prod',
            origin: window.location.origin
          });

          // Redirect to hosted payment page
          Airwallex.redirectToCheckout({
            intent_id: data.paymentIntentId,
            client_secret: data.clientSecret,
            currency: data.currency || 'USD',
            successUrl: `${window.location.origin}/?payment=success&order=${data.orderId}`,
            failUrl: `${window.location.origin}/?payment=failed`,
            cancelUrl: `${window.location.origin}/?payment=cancelled`
          });
        } else {
          throw new Error('Payment setup failed');
        }
      } catch (error) {
        errorDiv.textContent = error.message;
        errorDiv.style.display = 'block';
        showToast('error', error.message);
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    }

    function logout() {
      state.user = null;
      state.token = null;
      localStorage.removeItem('leadripper_user');
      localStorage.removeItem('leadripper_token');
      showPage('landing');
      showToast('info', 'You have been signed out.');
    }

    function showCancelModal() {
      if (!state.user) return;

      const modal = document.getElementById('cancelModal');
      const planNames = {
        trial: 'Free Trial',
        free: 'Free Plan',
        basic: 'Basic Plan',
        advanced: 'Advanced Plan',
        premium: 'Premium Plan',
        enterprise: 'Enterprise Plan',
        starter: 'Starter Plan',
        unlimited: 'Unlimited Plan'
      };

      document.getElementById('cancelModalPlan').textContent = planNames[state.user.plan] || state.user.plan;

      // Calculate end date (show trial end date or next billing date)
      let endDate = 'End of billing period';
      if (state.user.trial_ends_at) {
        endDate = new Date(state.user.trial_ends_at).toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
      }
      document.getElementById('cancelModalDate').textContent = endDate;

      modal.style.display = 'flex';
    }

    function hideCancelModal() {
      document.getElementById('cancelModal').style.display = 'none';
    }

    async function confirmCancelSubscription() {
      if (!state.token || !state.user) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/cancel-subscription`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({
            userId: state.user.id
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to cancel subscription');
        }

        showToast('success', 'Subscription cancelled. Access until end of billing period.');
        hideCancelModal();

        // Refresh user data and billing display
        await loadUserProfile();
        loadBillingData();

      } catch (error) {
        console.error('Cancel subscription error:', error);
        showToast('error', error.message || 'Failed to cancel subscription');
      }
    }

    function updateUserUI() {
      if (state.user) {
        document.getElementById('userName').textContent = state.user.name || state.user.email.split('@')[0];
        document.getElementById('userAvatar').textContent = (state.user.name || state.user.email).charAt(0).toUpperCase();
        document.getElementById('settingsName').value = state.user.name || '';
        document.getElementById('settingsEmail').value = state.user.email || '';

        // Update plan display in sidebar
        const planNames = { trial: 'Free Trial', free: 'Free Plan', basic: 'Basic Plan', advanced: 'Advanced Plan', premium: 'Premium Plan', enterprise: 'Enterprise Plan' };
        const sidebarPlan = document.querySelector('.sidebar-user-plan');
        if (sidebarPlan) {
          let planText = planNames[state.user.plan] || 'Free Plan';
          // Show trial days remaining
          if (state.user.plan === 'trial' && state.user.trialEndsAt) {
            const trialEnd = new Date(state.user.trialEndsAt);
            const now = new Date();
            const daysLeft = Math.ceil((trialEnd - now) / (1000 * 60 * 60 * 24));
            if (daysLeft > 0) {
              planText = `Free Trial (${daysLeft} days left)`;
            } else {
              planText = 'Trial Expired - Upgrade Now';
            }
          }
          sidebarPlan.textContent = planText;
        }

        updateBillingDisplay();
      }
    }

    // ===== DATA LOADING =====
    async function loadUserData() {
      if (!state.token) return;

      try {
        // Load dashboard stats
        const statsRes = await fetch(`${API_BASE}/get-stats`, {
          headers: { 'Authorization': `Bearer ${state.token}` }
        });
        if (statsRes.ok) {
          const data = await statsRes.json();
          const stats = data.stats || {};
          document.getElementById('statTotalLeads').textContent = stats.totalLeads || 0;
          document.getElementById('statCitiesScraped').textContent = stats.citiesScraped || 0;
          document.getElementById('statVerifiedEmails').textContent = stats.syncedLeads || 0; // Using synced as verified proxy
          document.getElementById('statGhlSynced').textContent = stats.syncedLeads || 0;

          // Update user info from stats response
          if (data.user) {
            state.user = { ...state.user, ...data.user };
            localStorage.setItem('leadripper_user', JSON.stringify(state.user));
            updateUserUI();
          }

          // Render recent activity if available
          if (data.activity && data.activity.length > 0) {
            renderRecentActivity(data.activity);
          }

          // Render top industries if available
          if (data.topIndustries && data.topIndustries.length > 0) {
            renderTopIndustries(data.topIndustries);
          }
        }

        // Load scraped cities
        const citiesRes = await fetch(`${API_BASE}/get-scraped-cities`, {
          headers: { 'Authorization': `Bearer ${state.token}` }
        });
        if (citiesRes.ok) {
          const citiesData = await citiesRes.json();
          state.scrapedCities = citiesData.cities || [];
        }

        // Load leads for My Leads view
        await loadLeadsPage(1);

        // Load user settings for GHL and Resend config
        const settingsRes = await fetch(`${API_BASE}/get-settings`, {
          headers: { 'Authorization': `Bearer ${state.token}` }
        });
        if (settingsRes.ok) {
          const settings = await settingsRes.json();

          // GHL Configuration
          if (settings.hasGhlKey) {
            state.ghlConfig.apiKey = 'configured';
            state.ghlConfig.locationId = settings.ghl_location_id || '';
            state.ghlConfig.autoSync = settings.ghl_auto_sync || false;
            state.ghlConfig.pipelineId = settings.ghl_pipeline_id || '';
            state.ghlConfig.stageId = settings.ghl_stage_id || '';

            // Load industry-specific pipelines (already parsed by backend)
            state.ghlConfig.industryPipelines = settings.ghl_industry_pipelines || {};

            document.getElementById('ghlApiKey').value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
            document.getElementById('ghlLocationId').value = state.ghlConfig.locationId;
            document.getElementById('ghlAutoSync').checked = state.ghlConfig.autoSync;
            document.getElementById('ghlStatus').innerHTML = `
              <span class="badge badge-success">Connected</span>
              <span style="color: var(--text-secondary); font-size: 14px;">Ready to sync leads</span>
            `;

            // Render industry pipelines
            renderIndustryPipelines();
          }

          // Resend Configuration
          if (settings.hasResendKey) {
            state.resendConfig = { apiKey: 'configured' };
            const resendKeyInput = document.getElementById('resendApiKey');
            if (resendKeyInput) {
              resendKeyInput.value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
            }
            const resendStatus = document.getElementById('resendStatus');
            if (resendStatus) {
              resendStatus.innerHTML = `
                <span class="badge badge-success">Connected</span>
                <span style="color: var(--text-secondary); font-size: 14px;">Ready to send emails</span>
              `;
            }
          }

          // Webhook URL
          if (settings.webhook_url) {
            const webhookInput = document.getElementById('webhookUrl');
            if (webhookInput) {
              webhookInput.value = settings.webhook_url;
            }
          }
        }
      } catch (err) {
        console.error('Failed to load user data:', err);
      }
    }

    function renderRecentActivity(activity) {
      const container = document.getElementById('recentActivity');
      if (!container) return;

      if (activity.length === 0) {
        container.innerHTML = '<p style="color: var(--text-muted);">No recent activity</p>';
        return;
      }

      container.innerHTML = activity.map(item => `
        <div class="activity-item" style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-subtle);">
          <span style="color: var(--text-secondary);">${new Date(item.date).toLocaleDateString()}</span>
          <span style="color: var(--accent-primary); font-weight: 600;">${item.count} leads</span>
        </div>
      `).join('');
    }

    function renderTopIndustries(industries) {
      const container = document.getElementById('topIndustries');
      if (!container) return;

      if (industries.length === 0) {
        container.innerHTML = '<p style="color: var(--text-muted);">No industry data yet</p>';
        return;
      }

      const maxCount = Math.max(...industries.map(i => parseInt(i.count)));
      container.innerHTML = industries.map(item => `
        <div class="industry-item" style="margin-bottom: 12px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span style="color: var(--text-primary);">${item.industry}</span>
            <span style="color: var(--text-secondary);">${item.count}</span>
          </div>
          <div style="background: var(--bg-elevated); height: 6px; border-radius: 3px; overflow: hidden;">
            <div style="background: var(--gradient-primary); height: 100%; width: ${(parseInt(item.count) / maxCount) * 100}%;"></div>
          </div>
        </div>
      `).join('');
    }

    async function loadLeadsPage(page = 1) {
      if (!state.token) return;

      state.leadsPage = page;
      const offset = (page - 1) * state.leadsPerPage;

      try {
        const leadsRes = await fetch(`${API_BASE}/get-leads?limit=${state.leadsPerPage}&offset=${offset}`, {
          headers: { 'Authorization': `Bearer ${state.token}` }
        });
        if (leadsRes.ok) {
          const leadsData = await leadsRes.json();
          state.leads = leadsData.leads || [];
          state.leadsTotal = leadsData.total || 0;
          renderAllLeads();
        }
      } catch (error) {
        console.error('Error loading leads:', error);
      }
    }

    function renderAllLeads() {
      const container = document.getElementById('allLeads');

      if (!state.leads || state.leads.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">&#x1F4C2;</div>
            <div class="empty-state-title">No leads yet</div>
            <div class="empty-state-text">Your scraped leads will appear here</div>
          </div>
        `;
        return;
      }

      const totalPages = Math.ceil(state.leadsTotal / state.leadsPerPage);
      const startItem = (state.leadsPage - 1) * state.leadsPerPage + 1;
      const endItem = Math.min(state.leadsPage * state.leadsPerPage, state.leadsTotal);

      container.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding: 12px 16px; background: var(--bg-elevated); border-radius: 8px;">
          <span style="color: var(--text-secondary); font-size: 14px;">
            Showing ${startItem}-${endItem} of ${state.leadsTotal} leads
          </span>
          <div style="display: flex; gap: 8px; align-items: center;">
            <button class="btn btn-sm btn-secondary" onclick="loadLeadsPage(1)" ${state.leadsPage === 1 ? 'disabled' : ''}>
              First
            </button>
            <button class="btn btn-sm btn-secondary" onclick="loadLeadsPage(${state.leadsPage - 1})" ${state.leadsPage === 1 ? 'disabled' : ''}>
              Prev
            </button>
            <span style="padding: 0 12px; color: var(--text-primary);">
              Page ${state.leadsPage} of ${totalPages}
            </span>
            <button class="btn btn-sm btn-secondary" onclick="loadLeadsPage(${state.leadsPage + 1})" ${state.leadsPage >= totalPages ? 'disabled' : ''}>
              Next
            </button>
            <button class="btn btn-sm btn-secondary" onclick="loadLeadsPage(${totalPages})" ${state.leadsPage >= totalPages ? 'disabled' : ''}>
              Last
            </button>
          </div>
        </div>
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Business</th>
                <th>Email</th>
                <th>Phone</th>
                <th>City</th>
                <th>Industry</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${state.leads.map(lead => `
                <tr data-lead-id="${lead.id}">
                  <td>
                    <strong>${lead.business_name}</strong>
                    ${lead.website ? `<br><a href="${lead.website}" target="_blank" style="font-size: 11px; color: var(--accent-primary);">Visit Website</a>` : ''}
                  </td>
                  <td id="email-cell-${lead.id}">
                    ${lead.email
                      ? `<span style="color: var(--accent-tertiary);">${lead.email}</span>`
                      : `<button class="btn-mini btn-outline" onclick="scrapeEmailForLead(${lead.id})" id="scrape-btn-${lead.id}">
                           Scrape for Email
                         </button>`
                    }
                  </td>
                  <td>${lead.phone || '-'}</td>
                  <td>${lead.city || '-'}</td>
                  <td><span class="badge badge-neutral">${lead.industry || '-'}</span></td>
                  <td id="action-cell-${lead.id}">
                    ${lead.email
                      ? (lead.ghl_synced
                          ? `<span class="badge badge-success">&#x2713; Synced</span>`
                          : `<button class="btn-mini btn-primary" onclick="startFlowForLead(${lead.id})">
                               Start Flow
                             </button>`)
                      : `<span class="badge badge-warning">Need email first</span>`
                    }
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
        <div style="display: flex; justify-content: center; margin-top: 16px; padding: 12px; background: var(--bg-elevated); border-radius: 8px;">
          <div style="display: flex; gap: 8px; align-items: center;">
            <button class="btn btn-sm btn-secondary" onclick="loadLeadsPage(1)" ${state.leadsPage === 1 ? 'disabled' : ''}>
              First
            </button>
            <button class="btn btn-sm btn-secondary" onclick="loadLeadsPage(${state.leadsPage - 1})" ${state.leadsPage === 1 ? 'disabled' : ''}>
              Prev
            </button>
            <span style="padding: 0 12px; color: var(--text-primary);">
              Page ${state.leadsPage} of ${totalPages}
            </span>
            <button class="btn btn-sm btn-secondary" onclick="loadLeadsPage(${state.leadsPage + 1})" ${state.leadsPage >= totalPages ? 'disabled' : ''}>
              Next
            </button>
            <button class="btn btn-sm btn-secondary" onclick="loadLeadsPage(${totalPages})" ${state.leadsPage >= totalPages ? 'disabled' : ''}>
              Last
            </button>
          </div>
        </div>
      `;
    }

    // Scrape email for a specific lead
    async function scrapeEmailForLead(leadId) {
      const btn = document.getElementById(`scrape-btn-${leadId}`);
      if (btn) {
        btn.innerHTML = 'Scraping...';
        btn.disabled = true;
      }

      try {
        const response = await fetch(`${API_BASE}/scrape-email`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ leadId })
        });

        const data = await response.json();

        if (data.success && data.email) {
          // Update the email cell
          const emailCell = document.getElementById(`email-cell-${leadId}`);
          emailCell.innerHTML = `<span style="color: var(--accent-tertiary);">${data.email}</span>`;

          // Update the action cell to show Start Flow button
          const actionCell = document.getElementById(`action-cell-${leadId}`);
          actionCell.innerHTML = `
            <button class="btn-mini btn-primary" onclick="startFlowForLead(${leadId})">
              Start Flow
            </button>
          `;

          // Update state
          const lead = state.leads.find(l => l.id === leadId);
          if (lead) lead.email = data.email;

          showToast('success', `Email found: ${data.email}`);
        } else {
          // Show possible emails or failure message
          if (btn) {
            btn.innerHTML = 'Scrape for Email';
            btn.disabled = false;
          }

          if (data.possibleEmails && data.possibleEmails.length > 0) {
            showToast('info', `No email found. Try: ${data.possibleEmails[0]}`);
          } else {
            showToast('warning', data.message || 'Could not find email');
          }
        }
      } catch (error) {
        if (btn) {
          btn.innerHTML = 'Scrape for Email';
          btn.disabled = false;
        }
        showToast('error', 'Failed to scrape email');
      }
    }

    // Scrape all emails for leads that don't have them
    async function scrapeAllEmails() {
      const leadsWithoutEmail = state.leads.filter(lead => !lead.email && lead.website);

      if (leadsWithoutEmail.length === 0) {
        showToast('info', 'All leads with websites already have emails scraped');
        return;
      }

      const btn = document.getElementById('scrapeAllEmailsBtn');
      const originalText = btn.innerHTML;
      btn.disabled = true;

      let scraped = 0;
      let found = 0;
      const total = leadsWithoutEmail.length;

      showToast('info', `Starting to scrape ${total} leads for emails...`);

      for (const lead of leadsWithoutEmail) {
        scraped++;
        btn.innerHTML = `<span>&#x23F3;</span> Scraping ${scraped}/${total}...`;

        try {
          const response = await fetch(`${API_BASE}/scrape-email`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${state.token}`
            },
            body: JSON.stringify({ leadId: lead.id })
          });

          const data = await response.json();

          if (data.success && data.email) {
            found++;
            lead.email = data.email;

            // Update the email cell
            const emailCell = document.getElementById(`email-cell-${lead.id}`);
            if (emailCell) {
              emailCell.innerHTML = `<span style="color: var(--accent-tertiary);">${data.email}</span>`;
            }

            // Update the action cell to show Start Flow button
            const actionCell = document.getElementById(`action-cell-${lead.id}`);
            if (actionCell) {
              actionCell.innerHTML = `
                <button class="btn-mini btn-primary" onclick="startFlowForLead(${lead.id})">
                  Start Flow
                </button>
              `;
            }
          }

          // Small delay between requests to avoid rate limiting
          await new Promise(resolve => setTimeout(resolve, 500));
        } catch (error) {
          console.error(`Error scraping email for lead ${lead.id}:`, error);
        }
      }

      btn.disabled = false;
      btn.innerHTML = originalText;

      showToast('success', `Done! Found ${found} emails out of ${total} leads scraped.`);
    }

    // Start flow for a lead (sync to GHL)
    async function startFlowForLead(leadId) {
      const actionCell = document.getElementById(`action-cell-${leadId}`);
      actionCell.innerHTML = '<span class="badge badge-neutral">Syncing...</span>';

      try {
        const response = await fetch(`${API_BASE}/ghl-sync`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ leadIds: [leadId], startFlow: true })
        });

        const data = await response.json();

        if (data.success || response.ok) {
          actionCell.innerHTML = `<span class="badge badge-success">&#x2713; Flow Started</span>`;

          // Update state
          const lead = state.leads.find(l => l.id === leadId);
          if (lead) lead.ghl_synced = true;

          showToast('success', 'Lead synced to GoHighLevel! Flow started.');
        } else {
          actionCell.innerHTML = `
            <button class="btn-mini btn-primary" onclick="startFlowForLead(${leadId})">
              Start Flow
            </button>
          `;
          showToast('error', data.error || 'Failed to start flow');
        }
      } catch (error) {
        actionCell.innerHTML = `
          <button class="btn-mini btn-primary" onclick="startFlowForLead(${leadId})">
            Start Flow
          </button>
        `;
        showToast('error', 'Failed to sync with GoHighLevel');
      }
    }

    // ===== CITY INPUT =====
    function setupCityInput() {
      const input = document.getElementById('cityInput');
      const wrapper = document.getElementById('cityTagsWrapper');

      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && input.value.trim()) {
          e.preventDefault();
          addCity(input.value.trim());
          input.value = '';
        }
      });
    }

    function addCity(city) {
      if (state.selectedCities.includes(city)) return;
      state.selectedCities.push(city);
      renderCityTags();
      updateScrapeButton();
    }

    function removeCity(city) {
      state.selectedCities = state.selectedCities.filter(c => c !== city);
      renderCityTags();
      updateScrapeButton();
    }

    function renderCityTags() {
      const wrapper = document.getElementById('cityTagsWrapper');
      const input = document.getElementById('cityInput');
      const industry = document.getElementById('scrapeIndustry').value;

      const tagsHtml = state.selectedCities.map(city => {
        const isScraped = state.scrapedCities.some(
          s => s.city.toLowerCase() === city.toLowerCase() && s.industry === industry
        );
        return `
          <div class="tag ${isScraped ? 'scraped' : ''}">
            ${city}${isScraped ? ' (done)' : ''}
            <span class="tag-remove" onclick="removeCity('${city}')">&times;</span>
          </div>
        `;
      }).join('');

      wrapper.innerHTML = tagsHtml + `<input type="text" class="tags-input" id="cityInput" placeholder="e.g., Austin, TX">`;

      // Re-setup event listener
      const newInput = document.getElementById('cityInput');
      newInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && newInput.value.trim()) {
          e.preventDefault();
          addCity(newInput.value.trim());
          newInput.value = '';
        }
      });
      newInput.focus();
    }

    function updateScrapeButton() {
      const industry = document.getElementById('scrapeIndustry').value;
      const btn = document.getElementById('startScrapeBtn');
      btn.disabled = !industry || state.selectedCities.length === 0;
    }

    // Update when industry changes
    document.addEventListener('DOMContentLoaded', () => {
      const industrySelect = document.getElementById('scrapeIndustry');
      if (industrySelect) {
        industrySelect.addEventListener('change', () => {
          renderCityTags();
          updateScrapeButton();
        });
      }

      // GHL auto-sync toggle
      const autoSyncToggle = document.getElementById('ghlAutoSync');
      if (autoSyncToggle) {
        autoSyncToggle.addEventListener('change', saveGhlAutoSync);
      }
    });

    // ===== SCRAPING =====
    async function startScrape() {
      const industry = document.getElementById('scrapeIndustry').value;
      const maxResults = parseInt(document.getElementById('scrapeMaxResults').value);
      const btn = document.getElementById('startScrapeBtn');
      const progressContainer = document.getElementById('scrapeProgress');
      const progressBar = document.getElementById('scrapeProgressBar');
      const progressText = document.getElementById('scrapeProgressText');

      if (!state.token) {
        showToast('error', 'Please log in to scrape leads');
        return;
      }

      // Filter out already scraped
      const citiesToScrape = state.selectedCities.filter(city =>
        !state.scrapedCities.some(
          s => s.city && s.city.toLowerCase() === city.toLowerCase() && s.industry === industry
        )
      );

      if (citiesToScrape.length === 0) {
        showToast('info', 'All selected cities have already been scraped for this industry.');
        return;
      }

      btn.classList.add('loading');
      btn.disabled = true;
      progressContainer.classList.add('active');
      progressBar.style.width = '10%';
      progressText.textContent = 'Initiating scrape...';

      try {
        // Trigger the scrape via API
        const response = await fetch(`${API_BASE}/trigger-scrape`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({
            cities: citiesToScrape,
            industry,
            maxResults
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Scrape failed');
        }

        progressBar.style.width = '50%';
        progressText.textContent = `Scraping ${data.citiesToScrape} cities...`;

        // Poll for results (or simulate progress)
        await simulateScrapeProgress(citiesToScrape, industry, maxResults, progressBar, progressText);

        progressBar.style.width = '100%';
        progressText.textContent = 'Complete!';

        // Reload data to get actual results
        await loadUserData();

        // Show current session results - match by city (flexible matching) and industry
        const normalizeCity = (city) => {
          if (!city) return '';
          return city.toLowerCase().split(',')[0].trim();
        };

        const scrapedCityNames = citiesToScrape.map(c => normalizeCity(c));

        state.currentResults = state.leads.filter(l => {
          const leadCity = normalizeCity(l.city);
          const cityMatch = scrapedCityNames.some(c => leadCity.includes(c) || c.includes(leadCity));
          const industryMatch = l.industry && l.industry.toLowerCase() === industry.toLowerCase();
          return cityMatch && industryMatch;
        });

        console.log('Scrape results:', state.currentResults.length, 'leads found for', scrapedCityNames, industry);
        renderResults();

        document.getElementById('exportCsvBtn').disabled = state.currentResults.length === 0;
        document.getElementById('syncGhlBtn').disabled = state.currentResults.length === 0;

        // Clear selected cities
        state.selectedCities = [];
        renderCityTags();

        showToast('success', `Scrape initiated! ${data.citiesToScrape} cities queued.`);

      } catch (error) {
        showToast('error', error.message);
        progressText.textContent = 'Failed';
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;

        setTimeout(() => {
          progressContainer.classList.remove('active');
        }, 3000);
      }
    }

    async function simulateScrapeProgress(cities, industry, maxResults, progressBar, progressText) {
      // Simulate progress while n8n processes in background
      for (let i = 0; i < cities.length; i++) {
        progressBar.style.width = `${50 + ((i + 1) / cities.length) * 40}%`;
        progressText.textContent = `Processing ${cities[i]}... (${i + 1}/${cities.length})`;
        await sleep(1500); // Simulate processing time
      }
    }

    function generateMockLeads(city, industry, count) {
      const leads = [];
      const businessPrefixes = ['Elite', 'Premier', 'Quality', 'Advanced', 'Pro', 'Expert', 'Best', 'Top'];
      const businessSuffixes = {
        dentist: ['Dental', 'Dentistry', 'Dental Care', 'Family Dental'],
        lawyer: ['Law Firm', 'Legal', 'Attorneys', 'Law Office'],
        plumber: ['Plumbing', 'Plumbing Co', 'Plumbing Services'],
        electrician: ['Electric', 'Electrical', 'Electric Co'],
        default: ['Services', 'Solutions', 'Group', 'Co']
      };

      for (let i = 0; i < Math.min(count, 20); i++) {
        const prefix = businessPrefixes[Math.floor(Math.random() * businessPrefixes.length)];
        const suffixes = businessSuffixes[industry] || businessSuffixes.default;
        const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];

        leads.push({
          id: `lead_${Date.now()}_${i}`,
          business_name: `${prefix} ${suffix}`,
          email: `contact@${prefix.toLowerCase()}${suffix.replace(/\s/g, '').toLowerCase()}.com`,
          phone: `(${Math.floor(Math.random() * 900) + 100}) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`,
          city: city,
          industry: industry,
          verified: Math.random() > 0.3,
          scraped_at: new Date().toISOString()
        });
      }
      return leads;
    }

    function renderResults() {
      const container = document.getElementById('scrapeResults');

      if (state.currentResults.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">&#x1F50E;</div>
            <div class="empty-state-title">No results yet</div>
            <div class="empty-state-text">Configure your search above and click "Start Scraping"</div>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Business</th>
                <th>Email</th>
                <th>Phone</th>
                <th>City</th>
                <th>Industry</th>
              </tr>
            </thead>
            <tbody>
              ${state.currentResults.map(lead => `
                <tr>
                  <td>
                    <strong>${lead.business_name}</strong>
                    ${lead.website ? `<br><a href="${lead.website}" target="_blank" style="font-size: 11px; color: var(--accent-primary);">Visit Website</a>` : ''}
                  </td>
                  <td>${lead.email ? `<span style="color: var(--accent-tertiary);">${lead.email}</span>` : '<span style="color: var(--text-muted);">-</span>'}</td>
                  <td>${lead.phone || '-'}</td>
                  <td>${lead.city || '-'}</td>
                  <td><span class="badge badge-neutral">${lead.industry || '-'}</span></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
        <div style="margin-top: 16px; color: var(--text-secondary); font-size: 14px;">
          Found ${state.currentResults.length} leads
        </div>
      `;
    }

    // ===== EXPORT & SYNC =====
    function exportToCsv() {
      if (state.currentResults.length === 0) return;

      const headers = ['Business Name', 'Email', 'Phone', 'City', 'Industry', 'Verified', 'Scraped At'];
      const rows = state.currentResults.map(l => [
        l.business_name,
        l.email,
        l.phone,
        l.city,
        l.industry,
        l.verified ? 'Yes' : 'No',
        l.scraped_at
      ]);

      const csv = [headers, ...rows].map(r => r.join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = `leadripper_export_${Date.now()}.csv`;
      a.click();

      showToast('success', 'Leads exported to CSV!');
    }

    function exportAllLeadsToCsv() {
      if (!state.leads || state.leads.length === 0) {
        showToast('info', 'No leads to export');
        return;
      }

      const headers = ['Business Name', 'Email', 'Phone', 'Address', 'City', 'State', 'Industry', 'Website', 'Rating', 'Reviews', 'GHL Synced', 'Created At'];
      const rows = state.leads.map(l => [
        `"${(l.business_name || '').replace(/"/g, '""')}"`,
        l.email || '',
        l.phone || '',
        `"${(l.address || '').replace(/"/g, '""')}"`,
        l.city || '',
        l.state || '',
        l.industry || '',
        l.website || '',
        l.rating || '',
        l.reviews || '',
        l.ghl_synced ? 'Yes' : 'No',
        l.created_at || ''
      ]);

      const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = `leadripper_all_leads_${Date.now()}.csv`;
      a.click();

      showToast('success', `${state.leads.length} leads exported to CSV!`);
    }

    async function syncAllToGhl() {
      if (!state.ghlConfig.apiKey || state.ghlConfig.apiKey === '') {
        showToast('error', 'Please configure your GHL API key first.');
        showDashboardView('ghl');
        return;
      }

      if (!state.leads || state.leads.length === 0) {
        showToast('info', 'No leads to sync');
        return;
      }

      const unsyncedLeads = state.leads.filter(l => !l.ghl_synced);
      if (unsyncedLeads.length === 0) {
        showToast('info', 'All leads are already synced to GHL');
        return;
      }

      showToast('info', `Syncing ${unsyncedLeads.length} leads to GoHighLevel...`);

      try {
        const leadIds = unsyncedLeads.map(l => l.id);
        const response = await fetch(`${API_BASE}/ghl-sync`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ leadIds })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Sync failed');
        }

        await loadUserData();
        showToast('success', `${data.syncedCount || unsyncedLeads.length} leads synced to GoHighLevel!`);
      } catch (error) {
        showToast('error', error.message);
      }
    }

    async function syncToGhl() {
      if (!state.ghlConfig.apiKey) {
        showToast('error', 'Please configure your GHL API key first.');
        showDashboardView('ghl');
        return;
      }

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      const btn = document.getElementById('syncGhlBtn');
      btn.classList.add('loading');
      btn.disabled = true;

      try {
        // Get lead IDs that haven't been synced
        const unsyncedLeads = state.currentResults.filter(l => !l.ghl_synced);
        const leadIds = unsyncedLeads.map(l => l.id);

        if (leadIds.length === 0) {
          showToast('info', 'All leads already synced to GHL');
          return;
        }

        const response = await fetch(`${API_BASE}/ghl-sync`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ leadIds })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Sync failed');
        }

        // Reload data to reflect changes
        await loadUserData();

        showToast('success', `${data.syncedCount} leads synced to GoHighLevel!`);
      } catch (error) {
        showToast('error', error.message);
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    }

    // ===== GHL SETTINGS =====
    async function saveGhlKey() {
      const key = document.getElementById('ghlApiKey').value;
      if (!key || key.includes('â€¢â€¢')) return;

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ ghlApiKey: key })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        state.ghlConfig.apiKey = key;
        document.getElementById('ghlApiKey').value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
        document.getElementById('ghlStatus').innerHTML = `
          <span class="badge badge-success">Connected</span>
          <span style="color: var(--text-secondary); font-size: 14px;">Ready to sync leads</span>
        `;

        showToast('success', 'GHL API key saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    async function saveGhlLocation() {
      const locationId = document.getElementById('ghlLocationId').value;

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ ghlLocationId: locationId })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        state.ghlConfig.locationId = locationId;
        showToast('success', 'Location ID saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    async function saveGhlAutoSync() {
      const autoSync = document.getElementById('ghlAutoSync').checked;

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ ghlAutoSync: autoSync })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        state.ghlConfig.autoSync = autoSync;
        showToast('success', 'Auto-sync setting saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    async function fetchGhlPipelines() {
      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      const btn = document.getElementById('fetchPipelinesBtn');
      btn.innerHTML = 'Loading...';
      btn.disabled = true;

      try {
        const response = await fetch(`${API_BASE}/ghl-pipelines`, {
          headers: { 'Authorization': `Bearer ${state.token}` }
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to fetch pipelines');
        }

        state.ghlPipelines = data.pipelines || [];
        populatePipelineDropdowns();
        showToast('success', `Loaded ${state.ghlPipelines.length} pipelines from GHL!`);

        // Update connection status
        const statusDiv = document.getElementById('ghlStatus');
        if (statusDiv) {
          statusDiv.innerHTML = `
            <span class="badge badge-success">Connected</span>
            <span style="color: var(--text-secondary); font-size: 14px;">${state.ghlPipelines.length} pipelines available</span>
          `;
        }
      } catch (error) {
        showToast('error', error.message);
      } finally {
        btn.innerHTML = 'Fetch Pipelines from GHL';
        btn.disabled = false;
      }
    }

    function populatePipelineDropdowns() {
      const defaultSelect = document.getElementById('ghlPipeline');
      if (defaultSelect) {
        defaultSelect.innerHTML = `
          <option value="">-- Select Pipeline --</option>
          ${state.ghlPipelines.map(p => `
            <option value="${p.id}" ${state.ghlConfig.pipelineId === p.id ? 'selected' : ''}>${p.name} (${p.stages.length} stages)</option>
          `).join('')}
        `;
      }

      // Populate stages for selected pipeline
      populateStageDropdown();

      // Re-render industry pipelines to use dropdowns
      renderIndustryPipelines();
    }

    function onPipelineChange() {
      const pipelineSelect = document.getElementById('ghlPipeline');
      state.ghlConfig.pipelineId = pipelineSelect?.value || '';
      populateStageDropdown();
    }

    function populateStageDropdown() {
      const stageSelect = document.getElementById('ghlStage');
      if (!stageSelect) return;

      const selectedPipeline = state.ghlPipelines.find(p => p.id === state.ghlConfig.pipelineId);
      if (selectedPipeline && selectedPipeline.stages.length > 0) {
        stageSelect.innerHTML = `
          <option value="">-- Select Stage --</option>
          ${selectedPipeline.stages.map(s => `
            <option value="${s.id}" ${state.ghlConfig.stageId === s.id ? 'selected' : ''}>${s.name}</option>
          `).join('')}
        `;
      } else {
        stageSelect.innerHTML = '<option value="">-- Select Pipeline First --</option>';
      }
    }

    async function saveDefaultPipelineAndStage() {
      const pipelineSelect = document.getElementById('ghlPipeline');
      const stageSelect = document.getElementById('ghlStage');
      const pipelineId = pipelineSelect?.value || '';
      const stageId = stageSelect?.value || '';

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ ghlPipelineId: pipelineId, ghlStageId: stageId })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        state.ghlConfig.pipelineId = pipelineId;
        state.ghlConfig.stageId = stageId;
        showToast('success', 'Pipeline and stage saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    // ===== INDUSTRY PIPELINE SETTINGS =====
    function renderIndustryPipelines() {
      const container = document.getElementById('industryPipelinesContainer');
      if (!container) return;

      const configs = state.ghlConfig.industryPipelines || {};
      const hasPipelines = state.ghlPipelines.length > 0;

      // Header row
      let html = `
        <div style="display: flex; gap: 12px; margin-bottom: 12px; padding: 8px 12px; border-bottom: 1px solid var(--border-subtle);">
          <div style="width: 140px; font-weight: 600; color: var(--text-secondary); font-size: 13px;">INDUSTRY</div>
          <div style="flex: 1; min-width: 150px; font-weight: 600; color: var(--text-secondary); font-size: 13px;">PIPELINE</div>
          <div style="flex: 1; min-width: 150px; font-weight: 600; color: var(--text-secondary); font-size: 13px;">STAGE</div>
        </div>
      `;

      // Industry rows
      html += COMMON_INDUSTRIES.map(industry => {
        const config = configs[industry] || {};
        const pipelineId = typeof config === 'object' ? config.pipelineId : config;
        const stageId = typeof config === 'object' ? config.stageId : '';
        const selectedPipeline = state.ghlPipelines.find(p => p.id === pipelineId);
        const isConfigured = !!pipelineId;

        return `
        <div class="industry-pipeline-row" style="display: flex; gap: 12px; align-items: center; margin-bottom: 8px; padding: 10px 12px; background: ${isConfigured ? 'var(--bg-elevated)' : 'var(--bg-surface)'}; border-radius: 8px; border: 1px solid ${isConfigured ? 'var(--accent-primary)' : 'var(--border-subtle)'};">
          <div style="width: 140px;">
            <span style="font-weight: 500; color: ${isConfigured ? 'var(--accent-primary)' : 'var(--text-secondary)'};">${industry}</span>
          </div>
          <div style="flex: 1; min-width: 150px;">
            ${hasPipelines ? `
              <select class="form-select" onchange="updateIndustryConfig('${industry}', 'pipeline', this.value)" style="width: 100%; padding: 8px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: 6px; color: var(--text-primary);">
                <option value="">-- Select Pipeline --</option>
                ${state.ghlPipelines.map(p => `
                  <option value="${p.id}" ${pipelineId === p.id ? 'selected' : ''}>${p.name}</option>
                `).join('')}
              </select>
            ` : `
              <select class="form-select" disabled style="width: 100%; padding: 8px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: 6px; color: var(--text-muted);">
                <option>Fetch pipelines first</option>
              </select>
            `}
          </div>
          <div style="flex: 1; min-width: 150px;">
            ${hasPipelines ? `
              <select class="form-select" onchange="updateIndustryConfig('${industry}', 'stage', this.value)" style="width: 100%; padding: 8px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: 6px; color: var(--text-primary);" ${!selectedPipeline ? 'disabled' : ''}>
                ${selectedPipeline ? `
                  <option value="">-- First Stage --</option>
                  ${selectedPipeline.stages.map(s => `
                    <option value="${s.id}" ${stageId === s.id ? 'selected' : ''}>${s.name}</option>
                  `).join('')}
                ` : `
                  <option value="">-- Select Pipeline First --</option>
                `}
              </select>
            ` : `
              <select class="form-select" disabled style="width: 100%; padding: 8px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: 6px; color: var(--text-muted);">
                <option>Fetch pipelines first</option>
              </select>
            `}
          </div>
        </div>
      `}).join('');

      container.innerHTML = html;
    }

    function updateIndustryConfig(industry, field, value) {
      console.log('updateIndustryConfig called:', { industry, field, value });
      console.log('state.ghlPipelines:', state.ghlPipelines);

      const configs = { ...state.ghlConfig.industryPipelines } || {};

      // Initialize config for this industry if needed
      if (!configs[industry] || typeof configs[industry] !== 'object') {
        configs[industry] = { pipelineId: '', stageId: '' };
      }

      if (field === 'pipeline') {
        configs[industry].pipelineId = value;
        configs[industry].stageId = ''; // Reset stage when pipeline changes

        // Log the selected pipeline to debug
        const selectedPipeline = state.ghlPipelines.find(p => p.id === value);
        console.log('Selected pipeline:', selectedPipeline);
        console.log('Pipeline stages:', selectedPipeline?.stages);
      } else if (field === 'stage') {
        configs[industry].stageId = value;
      }

      // Remove entry if no pipeline selected
      if (!configs[industry].pipelineId) {
        delete configs[industry];
      }

      state.ghlConfig.industryPipelines = configs;
      console.log('Updated configs:', configs);

      saveIndustryPipelines();
      renderIndustryPipelines();
    }

    async function saveIndustryPipelines() {
      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({
            ghlIndustryPipelines: state.ghlConfig.industryPipelines
          })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        showToast('success', 'Industry pipelines saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    // ===== RESEND SETTINGS =====
    async function saveResendKey() {
      const key = document.getElementById('resendApiKey').value;
      if (!key || key.includes('â€¢â€¢')) return;

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ resendApiKey: key })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        state.resendConfig = { apiKey: key };
        document.getElementById('resendApiKey').value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
        document.getElementById('resendStatus').innerHTML = `
          <span class="badge badge-success">Connected</span>
          <span style="color: var(--text-secondary); font-size: 14px;">Ready to send emails</span>
        `;

        showToast('success', 'Resend API key saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    async function saveWebhookUrl() {
      const url = document.getElementById('webhookUrl').value;

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ webhookUrl: url })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        showToast('success', 'Webhook URL saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    // ===== PROFILE SETTINGS =====
    async function saveProfile() {
      const name = document.getElementById('settingsName').value;
      const company = document.getElementById('settingsCompany')?.value || '';

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ name, company })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to save');
        }

        if (data.user) {
          state.user = { ...state.user, ...data.user };
          localStorage.setItem('leadripper_user', JSON.stringify(state.user));
          updateUserUI();
        }

        showToast('success', 'Profile updated!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    // ===== TOAST NOTIFICATIONS =====
    function showToast(type, message) {
      const container = document.getElementById('toastContainer');
      const icons = {
        success: '&#x2713;',
        error: '&#x2717;',
        info: '&#x2139;'
      };

      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <span class="toast-icon">${icons[type]}</span>
        <span class="toast-message">${message}</span>
      `;

      container.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }

    // ===== BILLING =====
    async function upgradePlan(planId) {
      if (!state.token || !state.user) {
        showToast('error', 'Please log in first');
        showPage('login');
        return;
      }

      showToast('info', 'Preparing checkout...');

      try {
        const response = await fetch(`${API_BASE}/create-checkout`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({
            planId,
            email: state.user.email,
            userId: state.user.id
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to create checkout');
        }

        // Use Airwallex SDK to redirect to hosted payment page
        if (data.paymentIntentId && data.clientSecret) {
          // Initialize Airwallex SDK
          Airwallex.init({
            env: 'prod', // production environment
            origin: window.location.origin
          });

          // Redirect to hosted payment page
          Airwallex.redirectToCheckout({
            intent_id: data.paymentIntentId,
            client_secret: data.clientSecret,
            currency: data.currency || 'USD',
            successUrl: `${window.location.origin}/?payment=success&plan=${planId}`,
            failUrl: `${window.location.origin}/?payment=failed&plan=${planId}`,
            cancelUrl: `${window.location.origin}/?payment=cancelled`
          });
        } else {
          showToast('error', 'Payment setup failed');
        }
      } catch (error) {
        showToast('error', error.message);
      }
    }

    function updateBillingDisplay() {
      if (!state.user) return;

      const planConfig = {
        trial: { name: 'Free Trial', price: 0, features: '500 leads â€¢ 7-day trial â€¢ Basic features', limit: 500 },
        pending: { name: 'Pending', price: 0, features: 'Payment processing', limit: 0 },
        free: { name: 'Free', price: 0, features: '50 leads/month', limit: 50 },
        starter: { name: 'Starter', price: 29, features: '500 leads/month â€¢ GHL sync â€¢ CSV export', limit: 500 },
        basic: { name: 'Basic', price: 29, features: '500 leads/month â€¢ GHL sync â€¢ CSV export', limit: 500 },
        advanced: { name: 'Advanced', price: 79, features: '2,500 leads/month â€¢ Email verification â€¢ Priority support', limit: 2500 },
        premium: { name: 'Premium', price: 149, features: '10,000 leads/month â€¢ API access â€¢ Webhooks', limit: 10000 },
        unlimited: { name: 'Unlimited', price: 997, features: 'Unlimited leads â€¢ White-label â€¢ Dedicated support', limit: -1 },
        enterprise: { name: 'Enterprise', price: 297, features: 'Unlimited leads â€¢ White-label â€¢ Dedicated support', limit: -1 }
      };

      const plan = planConfig[state.user.plan] || planConfig.free;
      const leadsUsed = state.user.leadsUsed || 0;
      const leadsLimit = state.user.leadsLimit || plan.limit;

      document.getElementById('planName').textContent = plan.name;
      document.getElementById('planFeatures').textContent = plan.features;
      document.getElementById('planPrice').innerHTML = `$${plan.price}<span style="font-size: 16px; color: var(--text-muted);">/mo</span>`;

      // Show/hide cancel button based on plan
      const cancelBtn = document.getElementById('cancelPlanBtn');
      const planStatus = document.getElementById('planStatus');

      if (state.user.plan && state.user.plan !== 'free' && state.user.plan !== 'pending') {
        cancelBtn.style.display = 'block';

        // Show trial end date if in trial
        if (state.user.trial_ends_at) {
          const trialEnd = new Date(state.user.trial_ends_at);
          planStatus.textContent = `Trial ends ${trialEnd.toLocaleDateString()}`;
          planStatus.style.display = 'block';
        } else {
          planStatus.style.display = 'none';
        }
      } else {
        cancelBtn.style.display = 'none';
        planStatus.style.display = 'none';
      }

      document.getElementById('billingLeadsUsed').textContent = leadsUsed;
      document.getElementById('billingLeadsLimit').textContent = leadsLimit === -1 ? '/ âˆž' : `/ ${leadsLimit}`;

      const progressPercent = leadsLimit === -1 ? 0 : Math.min((leadsUsed / leadsLimit) * 100, 100);
      document.getElementById('leadsProgressBar').style.width = `${progressPercent}%`;

      // Update from stats
      const ghlSynced = document.getElementById('statGhlSynced').textContent;
      const citiesScraped = document.getElementById('statCitiesScraped').textContent;
      document.getElementById('billingGhlSyncs').textContent = ghlSynced;
      document.getElementById('billingCitiesScraped').textContent = citiesScraped;
    }

    // ===== UTILITIES =====
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // ===== ADMIN FUNCTIONS =====
    async function checkAdminStatus() {
      if (!state.token) return;

      try {
        const response = await fetch(`${API_BASE}/admin-get-users`, {
          headers: { 'Authorization': `Bearer ${state.token}` }
        });

        if (response.ok) {
          state.isAdmin = true;
          document.getElementById('adminSection').style.display = 'block';
        }
      } catch (e) {
        // Not admin, hide section
        state.isAdmin = false;
        document.getElementById('adminSection').style.display = 'none';
      }
    }

    async function loadAdminUsers() {
      if (!state.isAdmin) return;

      try {
        const response = await fetch(`${API_BASE}/admin-get-users`, {
          headers: { 'Authorization': `Bearer ${state.token}` }
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to load users');
        }

        state.adminUsers = data.users;
        document.getElementById('adminUserCount').textContent = data.totalCount;
        renderAdminUsers(state.adminUsers);
      } catch (error) {
        showToast('error', error.message);
      }
    }

    function filterAdminUsers() {
      const search = document.getElementById('adminSearchInput').value.toLowerCase();
      const filtered = state.adminUsers.filter(u =>
        u.email.toLowerCase().includes(search) ||
        (u.name && u.name.toLowerCase().includes(search)) ||
        (u.company && u.company.toLowerCase().includes(search))
      );
      renderAdminUsers(filtered);
    }

    function renderAdminUsers(users) {
      const tbody = document.getElementById('adminUsersBody');

      if (!users || users.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 40px;">
              <div class="empty-state">
                <div class="empty-state-icon">&#x1F465;</div>
                <div class="empty-state-title">No users found</div>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = users.map(user => {
        const planColors = {
          free: '#6b7280',
          trial: '#f59e0b',
          basic: '#3b82f6',
          advanced: '#8b5cf6',
          premium: '#10b981',
          enterprise: '#ef4444'
        };
        const planColor = planColors[user.plan] || '#6b7280';
        const isAdmin = user.isAdmin;
        const statusBadge = user.subscription.status === 'active'
          ? '<span style="color: #10b981;">Active</span>'
          : user.subscription.status === 'cancelled'
          ? '<span style="color: #ef4444;">Cancelled</span>'
          : '<span style="color: #6b7280;">None</span>';

        return `
          <tr>
            <td>
              <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; font-weight: 600;">
                  ${(user.name || user.email)[0].toUpperCase()}
                </div>
                <div>
                  <div style="font-weight: 500;">${user.name || 'No name'} ${isAdmin ? '<span style="color: var(--accent-danger);">[ADMIN]</span>' : ''}</div>
                  <div style="font-size: 12px; color: var(--text-secondary);">${user.email}</div>
                  ${user.company ? `<div style="font-size: 11px; color: var(--text-muted);">${user.company}</div>` : ''}
                </div>
              </div>
            </td>
            <td>
              <span style="padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: ${planColor}20; color: ${planColor}; text-transform: uppercase;">
                ${user.plan}
              </span>
              ${user.trialEndsAt && user.plan === 'trial' ? `<div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">Ends: ${new Date(user.trialEndsAt).toLocaleDateString()}</div>` : ''}
            </td>
            <td>
              <div style="font-family: 'Space Mono', monospace;">
                <span style="color: var(--accent-primary);">${user.leadsUsed}</span> / ${user.leadsLimit}
              </div>
              <div style="font-size: 11px; color: var(--text-muted);">Total: ${user.totalLeads}</div>
            </td>
            <td>${statusBadge}</td>
            <td style="font-size: 12px; color: var(--text-secondary);">${new Date(user.createdAt).toLocaleDateString()}</td>
            <td>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-ghost" style="padding: 6px 12px; font-size: 12px;" onclick="showAdminUserActions(${user.id}, '${user.email}')" ${isAdmin ? 'disabled' : ''}>
                  Actions
                </button>
                <button class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;" onclick="masqueradeAsUser(${user.id})" title="Login as this user" ${isAdmin ? 'disabled' : ''}>
                  &#x1F464;
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    function showAdminUserActions(userId, email) {
      const modal = document.getElementById('adminActionModal');
      document.getElementById('adminModalTitle').textContent = `Manage User: ${email}`;

      document.getElementById('adminModalBody').innerHTML = `
        <div style="display: flex; flex-direction: column; gap: 16px;">
          <div class="settings-section">
            <div class="settings-section-title">Subscription Actions</div>
            <div style="display: flex; flex-direction: column; gap: 12px;">
              <button class="btn btn-outline" style="justify-content: flex-start;" onclick="adminAction(${userId}, 'cancel')">
                <span>&#x274C;</span> Cancel Subscription
              </button>
              <button class="btn btn-outline" style="justify-content: flex-start;" onclick="adminAction(${userId}, 'extend_trial')">
                <span>&#x23F0;</span> Extend Trial (+7 days)
              </button>
              <button class="btn btn-outline" style="justify-content: flex-start;" onclick="adminAction(${userId}, 'reset_leads')">
                <span>&#x1F504;</span> Reset Leads Usage
              </button>
            </div>
          </div>

          <div class="settings-section">
            <div class="settings-section-title">Change Plan</div>
            <select id="adminPlanSelect" class="input-field">
              <option value="">Select a plan...</option>
              <option value="free">Free</option>
              <option value="trial">Trial</option>
              <option value="basic">Basic ($29/mo)</option>
              <option value="advanced">Advanced ($79/mo)</option>
              <option value="premium">Premium ($149/mo)</option>
              <option value="enterprise">Enterprise ($297/mo)</option>
            </select>
            <button class="btn btn-primary" style="margin-top: 12px; width: 100%;" onclick="adminUpgrade(${userId})">
              Apply Plan Change
            </button>
          </div>

          <div class="settings-section" style="border-top: 1px solid var(--border-medium); padding-top: 16px; margin-top: 8px;">
            <div class="settings-section-title" style="color: var(--accent-danger);">Danger Zone</div>
            <button class="btn" style="background: var(--accent-danger); color: white; width: 100%;" onclick="confirmDeleteUser(${userId}, '${email}')">
              <span>&#x1F5D1;</span> Delete User Account
            </button>
          </div>
        </div>
      `;

      document.getElementById('adminModalFooter').innerHTML = `
        <button class="btn btn-ghost" onclick="closeAdminModal()">Close</button>
      `;

      modal.style.display = 'flex';
    }

    function closeAdminModal() {
      document.getElementById('adminActionModal').style.display = 'none';
    }

    async function adminAction(userId, action) {
      try {
        const response = await fetch(`${API_BASE}/admin-update-subscription`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ userId, action })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Action failed');
        }

        showToast('success', data.message);
        closeAdminModal();
        loadAdminUsers();
      } catch (error) {
        showToast('error', error.message);
      }
    }

    async function adminUpgrade(userId) {
      const plan = document.getElementById('adminPlanSelect').value;
      if (!plan) {
        showToast('error', 'Please select a plan');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/admin-update-subscription`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ userId, action: 'upgrade', plan })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Upgrade failed');
        }

        showToast('success', data.message);
        closeAdminModal();
        loadAdminUsers();
      } catch (error) {
        showToast('error', error.message);
      }
    }

    function confirmDeleteUser(userId, email) {
      document.getElementById('adminModalBody').innerHTML = `
        <div style="text-align: center; padding: 20px;">
          <div style="font-size: 48px; margin-bottom: 16px;">&#x26A0;</div>
          <h3 style="margin-bottom: 12px; color: var(--accent-danger);">Delete User Account</h3>
          <p style="color: var(--text-secondary); margin-bottom: 20px;">
            Are you sure you want to permanently delete <strong>${email}</strong>?<br>
            This will also delete all their leads, settings, and data.<br>
            <strong>This action cannot be undone.</strong>
          </p>
          <div style="display: flex; gap: 12px; justify-content: center;">
            <button class="btn btn-ghost" onclick="showAdminUserActions(${userId}, '${email}')">Cancel</button>
            <button class="btn" style="background: var(--accent-danger); color: white;" onclick="deleteUser(${userId})">
              Yes, Delete User
            </button>
          </div>
        </div>
      `;
      document.getElementById('adminModalFooter').innerHTML = '';
    }

    async function deleteUser(userId) {
      try {
        const response = await fetch(`${API_BASE}/admin-delete-user`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ userId })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Delete failed');
        }

        showToast('success', data.message);
        closeAdminModal();
        loadAdminUsers();
      } catch (error) {
        showToast('error', error.message);
      }
    }

    async function masqueradeAsUser(userId) {
      try {
        const response = await fetch(`${API_BASE}/admin-masquerade`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ userId })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Masquerade failed');
        }

        // Save admin token for returning later
        localStorage.setItem('leadripper_admin_token', state.token);
        localStorage.setItem('leadripper_admin_user', JSON.stringify(state.user));

        // Switch to masquerade user
        state.token = data.token;
        state.user = data.user;
        state.masquerade = data.masquerade;
        localStorage.setItem('leadripper_token', data.token);
        localStorage.setItem('leadripper_user', JSON.stringify(data.user));

        showToast('success', `Now viewing as ${data.user.email}`);

        // Show masquerade banner
        showMasqueradeBanner();

        // Refresh the UI
        updateUserUI();
        loadUserData();
        showDashboardView('overview');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    function showMasqueradeBanner() {
      // Remove existing banner if any
      const existing = document.getElementById('masqueradeBanner');
      if (existing) existing.remove();

      const banner = document.createElement('div');
      banner.id = 'masqueradeBanner';
      banner.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: var(--accent-warning);
        color: #000;
        padding: 10px 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 16px;
        font-weight: 600;
      `;
      banner.innerHTML = `
        <span>&#x1F464; Viewing as: ${state.user.email}</span>
        <button onclick="exitMasquerade()" style="
          background: rgba(0,0,0,0.2);
          border: none;
          padding: 6px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 600;
        ">Exit Masquerade</button>
      `;
      document.body.insertBefore(banner, document.body.firstChild);

      // Adjust nav position
      document.querySelector('.nav').style.top = '45px';
    }

    function exitMasquerade() {
      // Restore admin session
      const adminToken = localStorage.getItem('leadripper_admin_token');
      const adminUser = localStorage.getItem('leadripper_admin_user');

      if (adminToken && adminUser) {
        state.token = adminToken;
        state.user = JSON.parse(adminUser);
        state.masquerade = null;
        localStorage.setItem('leadripper_token', adminToken);
        localStorage.setItem('leadripper_user', adminUser);
        localStorage.removeItem('leadripper_admin_token');
        localStorage.removeItem('leadripper_admin_user');

        // Remove masquerade banner
        const banner = document.getElementById('masqueradeBanner');
        if (banner) banner.remove();

        // Reset nav position
        document.querySelector('.nav').style.top = '0';

        showToast('success', 'Returned to admin account');
        updateUserUI();
        loadUserData();
        showDashboardView('admin');
        loadAdminUsers();
      } else {
        logout();
      }
    }

    // Check masquerade on page load
    function checkMasquerade() {
      const adminToken = localStorage.getItem('leadripper_admin_token');
      if (adminToken && state.user) {
        state.masquerade = { active: true };
        showMasqueradeBanner();
      }
    }
  </script>
</body>
</html>
